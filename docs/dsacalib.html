<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>dsacalib package &#8212; dsacalib 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="top" title="dsacalib 0.1 documentation" href="index.html" />
    <link rel="up" title="dsacalib" href="modules.html" />
    <link rel="prev" title="dsacalib" href="modules.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="dsacalib-package">
<h1>dsacalib package<a class="headerlink" href="#dsacalib-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-dsacalib.calib">
<span id="dsacalib-calib-module"></span><h2>dsacalib.calib module<a class="headerlink" href="#module-dsacalib.calib" title="Permalink to this headline">¶</a></h2>
<p>Functions for calibration of DSA-110 visibilities.</p>
<p>These functions use the CASA package casatools to calibrate
visibilities stored as measurement sets.</p>
<p>Author: Dana Simard, <a class="reference external" href="mailto:dana&#46;simard&#37;&#52;&#48;astro&#46;caltech&#46;edu">dana<span>&#46;</span>simard<span>&#64;</span>astro<span>&#46;</span>caltech<span>&#46;</span>edu</a>, 10/2019</p>
<dl class="function">
<dt id="dsacalib.calib.apply_and_correct_calibrations">
<code class="descclassname">dsacalib.calib.</code><code class="descname">apply_and_correct_calibrations</code><span class="sig-paren">(</span><em>msname</em>, <em>calibration_tables</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.calib.apply_and_correct_calibrations" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies and corrects calibration tables in an ms.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The measurement set filepath. Will open <cite>msname</cite>.ms.</li>
<li><strong>calibration_tables</strong> (<em>list</em>) &#8211; Calibration tables to apply. Each entry is a dictionary containing the
keywords &#8216;type&#8217; (calibration type, e.g. &#8216;K&#8217;), &#8216;spwmap&#8217; (spwmap for the
calibration), and &#8216;table&#8217; (full path to the calibration table).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The number of errors that occured during calibration.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">int</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.calib.apply_calibration">
<code class="descclassname">dsacalib.calib.</code><code class="descname">apply_calibration</code><span class="sig-paren">(</span><em>msname</em>, <em>calname</em>, <em>msnamecal=None</em>, <em>combine_spw=False</em>, <em>nspw=1</em>, <em>blbased=False</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.calib.apply_calibration" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies the calibration solution.</p>
<p>Applies delay, bandpass and complex gain tables to a measurement set.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The name of the measurement set to apply calibration solutions to.
Opens <cite>msname</cite>.ms</li>
<li><strong>calname</strong> (<em>str</em>) &#8211; The name of the calibrator. Tables that start with
<cite>msnamecal</cite>_`calname` will be applied to the measurement set.</li>
<li><strong>msnamecal</strong> (<em>str</em>) &#8211; The name of the measurement set used to model the calibration solutions
Calibration tables prefixed with <cite>msnamecal</cite>_`calname` will be opened
and applied. If <code class="docutils literal"><span class="pre">None</span></code>, <cite>msnamecal</cite> is set to <cite>msname</cite>. Defaults to
<code class="docutils literal"><span class="pre">None</span></code>.</li>
<li><strong>combine_spw</strong> (<em>bool</em>) &#8211; Set to True if multi-spw ms and spws in the ms were combined before
calibration.</li>
<li><strong>nspw</strong> (<em>int</em>) &#8211; The number of spws in the ms.</li>
<li><strong>blbased</strong> (<em>bool</em>) &#8211; Set to True if the calibration was baseline-based.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The number of errors that occured during calibration.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">int</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.calib.apply_calibration_tables">
<code class="descclassname">dsacalib.calib.</code><code class="descname">apply_calibration_tables</code><span class="sig-paren">(</span><em>cb</em>, <em>calibration_tables</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.calib.apply_calibration_tables" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies calibration tables to an open calibrater object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>cb</strong> (<em>cc.calibrater() instance</em>) &#8211; Measurement set should be opened already.</li>
<li><strong>calibration_tables</strong> (<em>list</em>) &#8211; Calibration tables to apply. Each entry is a dictionary containing the
keywords &#8216;type&#8217; (calibration type, e.g. &#8216;K&#8217;), &#8216;spwmap&#8217; (spwmap for the
calibration), and &#8216;table&#8217; (full path to the calibration table).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The number of errors that occured during calibration.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">int</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.calib.apply_delay_bp_cal">
<code class="descclassname">dsacalib.calib.</code><code class="descname">apply_delay_bp_cal</code><span class="sig-paren">(</span><em>msname</em>, <em>calname</em>, <em>blbased=False</em>, <em>msnamecal=None</em>, <em>combine_spw=False</em>, <em>nspw=1</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.calib.apply_delay_bp_cal" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies delay and bandpass calibration.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The name of the measurement set containing the visibilities. The
measurement set <cite>msname</cite>.ms will be opened.</li>
<li><strong>calname</strong> (<em>str</em>) &#8211; The name of the calibrator source used in calibration of the
measurement set. The tables <cite>msname</cite>_`calname`_kcal and
<cite>msnamecal</cite>_`calname`_bcal will be applied to the measurement set.</li>
<li><strong>blbased</strong> (<em>boolean</em>) &#8211; Set to True if baseline-based calibration routines were done. Defaults
False.</li>
<li><strong>msnamecal</strong> (<em>str</em>) &#8211; The prefix of the measurement set used to derive the calibration
solutions. If None, set to <cite>msname</cite>.</li>
<li><strong>combine_spw</strong> (<em>boolean</em>) &#8211; Set to True if the spws were combined when deriving the solutions.
Defaults False.</li>
<li><strong>nspw</strong> (<em>int</em>) &#8211; The number of spws in the dataset.  Only used if <cite>combine_spw</cite> is set
to True. Defaults 1.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The number of errors that occured during calibration.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">int</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.calib.calc_delays">
<code class="descclassname">dsacalib.calib.</code><code class="descname">calc_delays</code><span class="sig-paren">(</span><em>vis</em>, <em>df</em>, <em>nfavg=5</em>, <em>tavg=True</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.calib.calc_delays" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates power as a function of delay from the visibilities.</p>
<p>This uses scipy fftpack to fourier transform the visibilities along the
frequency axis.  The power as a function of delay can then be used in
fringe-fitting.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>vis</strong> (<em>ndarray</em>) &#8211; The complex visibilities. 4 dimensions, (baseline, time, frequency,
polarization).</li>
<li><strong>df</strong> (<em>float</em>) &#8211; The width of the frequency channels in GHz.</li>
<li><strong>nfavg</strong> (<em>int</em>) &#8211; The number of frequency channels to average by after the Fourier
transform.  Defaults to 5.</li>
<li><strong>tavg</strong> (<em>boolean</em>) &#8211; If <code class="docutils literal"><span class="pre">True</span></code>, the visibilities are averaged in time before the Fourier
transform. Defaults to <code class="docutils literal"><span class="pre">True</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>vis_ft</strong> (<em>ndarray</em>) &#8211; The complex visibilities, Fourier-transformed along the time axis. 3
(or 4, if <cite>tavg</cite> is set to False) dimensions, (baseline, delay,
polarization) (or (baseline, time, delay, polarization) if <cite>tavg</cite> is
set to False).</li>
<li><strong>delay_arr</strong> (<em>ndarray</em>) &#8211; Float, the values of the delay pixels in nanoseconds.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.calib.calibrate_gain">
<code class="descclassname">dsacalib.calib.</code><code class="descname">calibrate_gain</code><span class="sig-paren">(</span><em>msname</em>, <em>calname</em>, <em>caltable_prefix</em>, <em>refant</em>, <em>tga</em>, <em>tgp</em>, <em>blbased=False</em>, <em>combined=False</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.calib.calibrate_gain" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates gain calibration only.</p>
<p>Uses existing solutions for the delay and bandpass.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The name of the measurement set for gain calibration.</li>
<li><strong>calname</strong> (<em>str</em>) &#8211; The name of the calibrator used in calibration.</li>
<li><strong>caltable_prefix</strong> (<em>str</em>) &#8211; The prefix of the delay and bandpass tables to be applied.</li>
<li><strong>refant</strong> (<em>str</em>) &#8211; The name of the reference antenna.</li>
<li><strong>tga</strong> (<em>str</em>) &#8211; A casa-understood integration time for gain amplitude calibration.</li>
<li><strong>tgp</strong> (<em>str</em>) &#8211; A casa-understood integration time for gain phase calibration.</li>
<li><strong>blbased</strong> (<em>boolean</em>) &#8211; Set to True if using baseline-based calibration for gains. Defaults
False.</li>
<li><strong>combined</strong> (<em>boolean</em>) &#8211; Set to True if spectral windows are combined for calibration.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The number of errors that occured during calibration.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">int</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.calib.calibrate_phases">
<code class="descclassname">dsacalib.calib.</code><code class="descname">calibrate_phases</code><span class="sig-paren">(</span><em>filenames</em>, <em>refant</em>, <em>msdir='/mnt/data/dsa110/calibration/'</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.calib.calibrate_phases" title="Permalink to this definition">¶</a></dt>
<dd><p>Calibrate phases only for a group of calibrator passes.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>filenames</strong> (<em>dict</em>) &#8211; A dictionary containing information on the calibrator passes to be
calibrated. Same format as dictionary returned by
dsacalib.utils.get_filenames()</li>
<li><strong>refant</strong> (<em>str</em>) &#8211; The reference antenna name to use. If int, will be interpreted as the
reference antenna index instead.</li>
<li><strong>msdir</strong> (<em>str</em>) &#8211; The full path to the measurement set, with the <cite>.ms</cite> extension omitted.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.calib.delay_calibration">
<code class="descclassname">dsacalib.calib.</code><code class="descname">delay_calibration</code><span class="sig-paren">(</span><em>msname</em>, <em>sourcename</em>, <em>refant</em>, <em>t='inf'</em>, <em>combine_spw=False</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.calib.delay_calibration" title="Permalink to this definition">¶</a></dt>
<dd><p>Calibrates delays using CASA.</p>
<p>Uses CASA to calibrate delays and write the calibrated visibilities to the
corrected_data column of the measurement set.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The name of the measurement set.  The measurement set <cite>msname</cite>.ms will
be opened.</li>
<li><strong>sourcename</strong> (<em>str</em>) &#8211; The name of the calibrator source. The calibration table will be
written to <cite>msname</cite>_`sourcename`_kcal.</li>
<li><strong>refant</strong> (<em>str</em>) &#8211; The reference antenna to use in calibration. If  type <em>str</em>, this is
the name of the antenna.  If type <em>int</em>, it is the index of the antenna
in the measurement set.</li>
<li><strong>t</strong> (<em>str</em>) &#8211; The integration time to use before calibrating, e.g. <code class="docutils literal"><span class="pre">'inf'</span></code> or
<code class="docutils literal"><span class="pre">'60s'</span></code>.  See the CASA documentation for more examples. Defaults to
<code class="docutils literal"><span class="pre">'inf'</span></code> (averaging over the entire observation time).</li>
<li><strong>combine_spw</strong> (<em>boolean</em>) &#8211; If True, distinct spws in the same ms will be combined before delay
calibration.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The number of errors that occured during calibration.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">int</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.calib.fill_antenna_gains">
<code class="descclassname">dsacalib.calib.</code><code class="descname">fill_antenna_gains</code><span class="sig-paren">(</span><em>gains</em>, <em>flags=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.calib.fill_antenna_gains" title="Permalink to this definition">¶</a></dt>
<dd><p>Fills in the antenna gains for triple-antenna calibration.</p>
<p>Takes the gains from baseline-based calibration for a trio of antennas and
calculates the corresponding antenna gains using products of the baseline
gains. Also propagates flag information for the input baseline gains to
the antenna gains.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>gains</strong> (<em>narray</em>) &#8211; The complex gains matrix, first dimension is baseline. Indices 1, 2 and
4 contain the gains for the cross-correlations. Information in indices
0, 3 and 5 is ignored and overwritten.</li>
<li><strong>flags</strong> (<em>ndarray</em>) &#8211; A boolean array, containing flag information for the <cite>gains</cite> array. 1
if the data is flagged, 0 otherwise. If <code class="docutils literal"><span class="pre">None</span></code>, assumes no flag
information available.  The first dimension is baseline.  Indices 1, 2
and 4 contain the flags for the cross-correlations.  Information in
indices 0, 3 and 5 is ignored and overwritten.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>gains</strong> (<em>ndarray</em>) &#8211; The complex gains matrix, first dimension is baseline. Indices 1, 2 and
4 contain the gains for the cross-correlations. Indices 0, 3 and 5
contain the calculated values for the antennas.</li>
<li><strong>flags</strong> (<em>ndarray</em>) &#8211; A boolean array, containing flag information for the <cite>gains</cite> array. 1
if the data is flagged, 0 otherwise. If None, assumes no flag
information available. The first dimension is baseline.  Indices 1, 2
and 4 contain the flags for the cross-correlations.  Indices 0,3 and 5
contain the calculated values for the antennas.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.calib.flag_antenna">
<code class="descclassname">dsacalib.calib.</code><code class="descname">flag_antenna</code><span class="sig-paren">(</span><em>msname</em>, <em>antenna</em>, <em>datacolumn='data'</em>, <em>pol=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.calib.flag_antenna" title="Permalink to this definition">¶</a></dt>
<dd><p>Flags an antenna in a measurement set using CASA.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The name of the measurement set.  The MS <cite>msname</cite>.ms will be opened.</li>
<li><strong>antenna</strong> (<em>str</em>) &#8211; The antenna to flag. If type <em>str</em>, this is the name of the antenna. If
type <em>int</em>, the index of the antenna in the measurement set.</li>
<li><strong>datacolumn</strong> (<em>str</em>) &#8211; The column of the measurement set to flag. Options are <code class="docutils literal"><span class="pre">'data'</span></code>,
<code class="docutils literal"><span class="pre">'model'</span></code>, <code class="docutils literal"><span class="pre">'corrected'</span></code> for the uncalibrated visibilities, the
visibility model (used by CASA to calculate calibration solutions), the
calibrated visibilities.  Defaults to <code class="docutils literal"><span class="pre">'data'</span></code>.</li>
<li><strong>pol</strong> (<em>str</em>) &#8211; The polarization to flag. Must be <cite>&#8216;A&#8217;</cite> (which is mapped to
polarization &#8216;XX&#8217; of the CASA measurement set) or <cite>&#8216;B&#8217;</cite> (mapped to
polarization &#8216;YY&#8217;).  Can also be <cite>None</cite>, for which both polarizations
are flagged.  Defaults to <cite>None</cite>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The number of errors that occured during flagging.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">int</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.calib.flag_badtimes">
<code class="descclassname">dsacalib.calib.</code><code class="descname">flag_badtimes</code><span class="sig-paren">(</span><em>msname</em>, <em>times</em>, <em>bad</em>, <em>nant</em>, <em>datacolumn='data'</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.calib.flag_badtimes" title="Permalink to this definition">¶</a></dt>
<dd><p>Flags bad time bins for each antenna in a measurement set using CASA.</p>
<p>Could use some work to select antennas to flag in a smarter way.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The name of the measurement set. The MS <cite>msname</cite>.ms will be opened.</li>
<li><strong>times</strong> (<em>ndarray</em>) &#8211; A 1-D array of times, type float, seconds since MJD=0. Times should be
equally spaced and cover the entire time range of the measurement set,
but can be coarser than the resolution of the measurement set.</li>
<li><strong>bad</strong> (<em>ndarray</em>) &#8211; A 1-D boolean array with dimensions (len(<cite>times</cite>), <cite>nant</cite>). Should have
a value of <code class="docutils literal"><span class="pre">True</span></code> if the corresponding timebins should be flagged.</li>
<li><strong>nant</strong> (<em>int</em>) &#8211; The number of antennas in the measurement set (includes ones not in the
visibilities).</li>
<li><strong>datacolumn</strong> (<em>str</em>) &#8211; The column of the measurement set to flag. Options are <code class="docutils literal"><span class="pre">'data'</span></code>,
<code class="docutils literal"><span class="pre">'model'</span></code>, <code class="docutils literal"><span class="pre">'corrected'</span></code> for the uncalibrated visibilities, the
visibility model (used by CASA to calculate calibration solutions), the
calibrated visibilities.  Defaults to <code class="docutils literal"><span class="pre">'data'</span></code>.</li>
<li><strong>verbose</strong> (<em>boolean</em>) &#8211; If <code class="docutils literal"><span class="pre">True</span></code>, will print information about the antenna/time pairs being
flagged.  Defaults to <code class="docutils literal"><span class="pre">False</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The number of errors that occured during flagging.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">int</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.calib.flag_baselines">
<code class="descclassname">dsacalib.calib.</code><code class="descname">flag_baselines</code><span class="sig-paren">(</span><em>msname</em>, <em>datacolumn='data'</em>, <em>uvrange='2~15m'</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.calib.flag_baselines" title="Permalink to this definition">¶</a></dt>
<dd><p>Flags an antenna in a measurement set using CASA.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The name of the measurement set.  The MS <cite>msname</cite>.ms will be opened.</li>
<li><strong>datacolumn</strong> (<em>str</em>) &#8211; The column of the measurement set to flag. Options are <code class="docutils literal"><span class="pre">'data'</span></code>,
<code class="docutils literal"><span class="pre">'model'</span></code>, <code class="docutils literal"><span class="pre">'corrected'</span></code> for the uncalibrated visibilities, the
visibility model (used by CASA to calculate calibration solutions), the
calibrated visibilities.  Defaults to <code class="docutils literal"><span class="pre">'data'</span></code>.</li>
<li><strong>uvrange</strong> (<em>str</em>) &#8211; The uvrange to flag. Should be CASA-interpretable.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The number of errors that occured during flagging.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">int</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.calib.flag_manual">
<code class="descclassname">dsacalib.calib.</code><code class="descname">flag_manual</code><span class="sig-paren">(</span><em>msname</em>, <em>key</em>, <em>value</em>, <em>datacolumn='data'</em>, <em>pol=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.calib.flag_manual" title="Permalink to this definition">¶</a></dt>
<dd><p>Flags a measurement set in CASA using a flagging string.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The name of the measurement set.  The MS <cite>msname</cite>.ms will be opened.</li>
<li><strong>key</strong> (<em>str</em>) &#8211; The CASA-interpreted flagging specifier.</li>
<li><strong>datacolumn</strong> (<em>str</em>) &#8211; The column of the measurement set to flag. Options are <code class="docutils literal"><span class="pre">'data'</span></code>,
<code class="docutils literal"><span class="pre">'model'</span></code>, <code class="docutils literal"><span class="pre">'corrected'</span></code> for the uncalibrated visibilities, the
visibility model (used by CASA to calculate calibration solutions), the
calibrated visibilities.  Defaults to <code class="docutils literal"><span class="pre">'data'</span></code>.</li>
<li><strong>pol</strong> (<em>str</em>) &#8211; The polarization to flag. Must be <cite>&#8216;A&#8217;</cite> (which is mapped to
polarization &#8216;XX&#8217; of the CASA measurement set) or <cite>&#8216;B&#8217;</cite> (mapped to
polarization &#8216;YY&#8217;).  Can also be <cite>None</cite>, for which both polarizations
are flagged.  Defaults to <cite>None</cite>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The number of errors that occured during flagging.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">int</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.calib.flag_zeros">
<code class="descclassname">dsacalib.calib.</code><code class="descname">flag_zeros</code><span class="sig-paren">(</span><em>msname</em>, <em>datacolumn='data'</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.calib.flag_zeros" title="Permalink to this definition">¶</a></dt>
<dd><p>Flags all zeros in a measurement set.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The name of the measurement set. The MS <cite>msname</cite>.ms will be opened.</li>
<li><strong>datacolumn</strong> (<em>str</em>) &#8211; The column of the measurement set to flag. Options are <code class="docutils literal"><span class="pre">'data'</span></code>,
<code class="docutils literal"><span class="pre">'model'</span></code>, <code class="docutils literal"><span class="pre">'corrected'</span></code> for the uncalibrated visibilities, the
visibility model (used by CASA to calculate calibration solutions), the
calibrated visibilities.  Defaults to <code class="docutils literal"><span class="pre">'data'</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The number of errors that occured during flagging.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">int</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.calib.gain_calibration">
<code class="descclassname">dsacalib.calib.</code><code class="descname">gain_calibration</code><span class="sig-paren">(</span><em>msname</em>, <em>sourcename</em>, <em>refant</em>, <em>blbased=False</em>, <em>forsystemhealth=False</em>, <em>keepdelays=False</em>, <em>tbeam='30s'</em>, <em>interp_thresh=1.5</em>, <em>interp_polyorder=7</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.calib.gain_calibration" title="Permalink to this definition">¶</a></dt>
<dd><p>Use CASA to calculate bandpass and complex gain solutions.</p>
<p>Saves solutions to calibration tables and calibrates the measurement set by
applying delay, bandpass, and complex gain solutions.  Uses baseline-based
calibration routines within CASA.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The name of the measurement set.  The MS <cite>msname</cite>.ms will be opened.</li>
<li><strong>sourcename</strong> (<em>str</em>) &#8211; The name of the calibrator source.  The calibration table will be
written to <cite>msname</cite>_`sourcename`_kcal.</li>
<li><strong>refant</strong> (<em>str</em>) &#8211; The reference antenna to use in calibration.  If type <em>str</em>, this is
the name of the antenna.  If type <em>int</em>, it is the index of the antenna
in the measurement set.</li>
<li><strong>blbased</strong> (<em>boolean</em>) &#8211; Set to True if baseline-based calibration desired.</li>
<li><strong>forsystemhealth</strong> (<em>boolean</em>) &#8211; Set to True if gain calibration is for system health monitoring. Delays
will be kept at full resolution. If set to False, then at least some of
the delay will be incorporated into the bandpass gain table.</li>
<li><strong>keepdelays</strong> (<em>boolean</em>) &#8211; Set to True if you want to update the delays currently set in the
system. In this case, delay changes of integer 2 ns will be kept in the
delay calibration table, and residual delays will be incorporated into
the bandpass gain table. If set to False, all of the delay will be
incorporated into the bandpass gain table.</li>
<li><strong>tbeam</strong> (<em>str</em>) &#8211; The integration time to use when measuring gain variations over time,
e.g. <code class="docutils literal"><span class="pre">'inf'</span></code> or <code class="docutils literal"><span class="pre">'60s'</span></code>.  See the CASA documentation for more
examples.</li>
<li><strong>interp_thresh</strong> (<em>float</em>) &#8211; Sets flagging of bandpass solutions before interpolating in order to
smooth the solutions. After median baselining, any points that deviate
by more than interp_thresh*std are flagged.</li>
<li><strong>interp_polyorder</strong> (<em>int</em>) &#8211; The order of the polynomial used to smooth bandpass solutions.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The number of errors that occured during calibration.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">int</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.calib.get_bad_times">
<code class="descclassname">dsacalib.calib.</code><code class="descname">get_bad_times</code><span class="sig-paren">(</span><em>msname</em>, <em>sourcename</em>, <em>refant</em>, <em>tint='59s'</em>, <em>combine_spw=False</em>, <em>nspw=1</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.calib.get_bad_times" title="Permalink to this definition">¶</a></dt>
<dd><p>Flags bad times in the calibrator data.</p>
<p>Calculates delays on short time periods and compares them to the delay
calibration solution. Can only be run after delay calibration.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The name of the measurement set. The MS <cite>msname</cite>.ms will be opened.</li>
<li><strong>sourcename</strong> (<em>str</em>) &#8211; The name of the calibrator source.  The calibration table will be
written to <cite>msname</cite>_`sourcename`_kcal.</li>
<li><strong>refant</strong> (<em>str</em>) &#8211; The reference antenna to use in calibration. If type <em>str</em>, the name of
the reference antenna, if type <em>int</em>, the index of the antenna in the
CASA measurement set. This must be the same as the reference antenna
used in the delay calibration, or unexpected errors may occur.</li>
<li><strong>tint</strong> (<em>str</em>) &#8211; The timescale on which to calculate the delay solutions (and evaluate
the data quality). Must be a CASA-interpreted string, e.g. <code class="docutils literal"><span class="pre">'inf'</span></code>
(average all of the data) or <code class="docutils literal"><span class="pre">'60s'</span></code> (average data to 60-second bins
before delay calibration).  Defaults to <code class="docutils literal"><span class="pre">'59s'</span></code>.</li>
<li><strong>combine_spw</strong> (<em>bool</em>) &#8211; Set to True if the spws were combined before delay calibration.</li>
<li><strong>nspw</strong> (<em>int</em>) &#8211; The number of spws in the measurement set.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>bad_times</strong> (<em>array</em>) &#8211; Booleans, <code class="docutils literal"><span class="pre">True</span></code> if the data quality is poor and the time-bin should
be flagged, <code class="docutils literal"><span class="pre">False</span></code> otherwise.  Same dimensions as times.</li>
<li><strong>times</strong> (<em>array</em>) &#8211; Floats, the time (mjd) for each delay solution.</li>
<li><strong>error</strong> (<em>int</em>) &#8211; The number of errors that occured during calibration.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.calib.interpolate_bandpass_solutions">
<code class="descclassname">dsacalib.calib.</code><code class="descname">interpolate_bandpass_solutions</code><span class="sig-paren">(</span><em>msname</em>, <em>calname</em>, <em>thresh=1.5</em>, <em>polyorder=7</em>, <em>mode='ap'</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.calib.interpolate_bandpass_solutions" title="Permalink to this definition">¶</a></dt>
<dd><p>Interpolates bandpass solutions.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The measurement set filepath (with the <cite>.ms</cite> extension omitted).</li>
<li><strong>calname</strong> (<em>str</em>) &#8211; The name of the calibrator source. Calibration tables starting with
<cite>msname</cite>_`calname` will be opened.</li>
<li><strong>thresh</strong> (<em>float</em>) &#8211; Sets flagging of bandpass solutions before interpolating in order to
smooth the solutions. After median baselining, any points that deviate
by more than interp_thresh*std are flagged.</li>
<li><strong>polyorder</strong> (<em>int</em>) &#8211; The order of the polynomial used to smooth bandpass solutions.</li>
<li><strong>mode</strong> (<em>str</em>) &#8211; The bandpass calibration mode. Must be one of &#8220;a&#8221;, &#8220;p&#8221; or &#8220;ap&#8221;.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.calib.reset_flags">
<code class="descclassname">dsacalib.calib.</code><code class="descname">reset_flags</code><span class="sig-paren">(</span><em>msname</em>, <em>datacolumn=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.calib.reset_flags" title="Permalink to this definition">¶</a></dt>
<dd><p>Resets all flags in a measurement set, so that all data is unflagged.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The name of the measurement set. The MS <cite>msname</cite>.ms will be opened.</li>
<li><strong>datacolumn</strong> (<em>str</em>) &#8211; The column of the measurement set to flag. Options are <code class="docutils literal"><span class="pre">'data'</span></code>,
<code class="docutils literal"><span class="pre">'model'</span></code>, <code class="docutils literal"><span class="pre">'corrected'</span></code> for the uncalibrated visibilities, the
visibility model (used by CASA to calculate calibration solutions), the
calibrated visibilities.  Defaults to <code class="docutils literal"><span class="pre">'data'</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The number of errors that occured during flagging.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">int</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-dsacalib.constants">
<span id="dsacalib-constants-module"></span><h2>dsacalib.constants module<a class="headerlink" href="#module-dsacalib.constants" title="Permalink to this headline">¶</a></h2>
<p>Constants used in the calibration of DSA-110 visibilities.</p>
<p>Author: Dana Simard, <a class="reference external" href="mailto:dana&#46;simard&#37;&#52;&#48;astro&#46;caltech&#46;edu">dana<span>&#46;</span>simard<span>&#64;</span>astro<span>&#46;</span>caltech<span>&#46;</span>edu</a>, 10/2019</p>
</div>
<div class="section" id="module-dsacalib.fits_io">
<span id="dsacalib-fits-io-module"></span><h2>dsacalib.fits_io module<a class="headerlink" href="#module-dsacalib.fits_io" title="Permalink to this headline">¶</a></h2>
<p>DSACALIB/FITS_IO.PY</p>
<p>Dana Simard, <a class="reference external" href="mailto:dana&#46;simard&#37;&#52;&#48;astro&#46;caltech&#46;edu">dana<span>&#46;</span>simard<span>&#64;</span>astro<span>&#46;</span>caltech<span>&#46;</span>edu</a>, 10/2019</p>
<p>Modified for python3 from DSA-10 routines written by Vikram Ravi, Harish
Vendantham.</p>
<p>Routines to interact w/ fits visibilities recorded by DSA-10.</p>
<dl class="function">
<dt id="dsacalib.fits_io.extract_vis_from_psrfits">
<code class="descclassname">dsacalib.fits_io.</code><code class="descname">extract_vis_from_psrfits</code><span class="sig-paren">(</span><em>f</em>, <em>lstmid</em>, <em>seg_len</em>, <em>antenna_order</em>, <em>mjd0</em>, <em>mjd1</em>, <em>quiet=True</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.fits_io.extract_vis_from_psrfits" title="Permalink to this definition">¶</a></dt>
<dd><p>Extracts visibilities from a fits file.</p>
<p>Based on clip.extract_segment from DSA-10 routines.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>f</strong> (<em>pyfits table handle</em>) &#8211; The fits file containing the visibilities.</li>
<li><strong>lstmid</strong> (<em>float</em>) &#8211; The LST around which to extract visibilities, in radians.</li>
<li><strong>seg_len</strong> (<em>float</em>) &#8211; The duration (in LST) of visibilities to extract, in radians.</li>
<li><strong>antenna_order</strong> (<em>list</em>) &#8211; The order of the antennas in the correlator.</li>
<li><strong>mjd0</strong> (<em>float</em>) &#8211; The start time of the file in MJD.</li>
<li><strong>mjd1</strong> (<em>float</em>) &#8211; The stop time of the file in MJD.</li>
<li><strong>quiet</strong> (<em>boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">False</span></code>, information on the file will be printed. Defaults
<code class="docutils literal"><span class="pre">True</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>vis</strong> (<em>ndarray</em>) &#8211; The requested visibilities, dimensions (baselines, time, frequency).</li>
<li><strong>lst</strong> (<em>array</em>) &#8211; The lst of each integration in the visibilities, in radians.</li>
<li><strong>mjd</strong> (<em>array</em>) &#8211; The midpoint mjd of each integration in the visibilities.</li>
<li><strong>idxmid</strong> (<em>int</em>) &#8211; The index along the time axis corresponding to the <cite>lstmid</cite>. (i.e the
index corresponding to the meridian transit of the source.)</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.fits_io.get_header_info">
<code class="descclassname">dsacalib.fits_io.</code><code class="descname">get_header_info</code><span class="sig-paren">(</span><em>f</em>, <em>antpos=None</em>, <em>verbose=False</em>, <em>antenna_order=None</em>, <em>dsa10=True</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.fits_io.get_header_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Extracts important header info from a visibility fits file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>f</strong> (<em>pyfits table handle</em>) &#8211; The visibility data from the correlator.</li>
<li><strong>antpos</strong> (<em>str</em>) &#8211; The path to the text file containing the antenna positions. Defaults
<cite>dsacalib.constants.PKG_DATA_PATH</cite>.</li>
<li><strong>verbose</strong> (<em>boolean</em>) &#8211; If <code class="docutils literal"><span class="pre">True</span></code>, information on the fits file is printed to stdout.</li>
<li><strong>antenna_order</strong> (<em>list</em>) &#8211; The order of the antennas in the correlator.  Required if <cite>dsa10</cite> is
set to <code class="docutils literal"><span class="pre">False</span></code>. Defaults <code class="docutils literal"><span class="pre">None</span></code>.</li>
<li><strong>dsa10</strong> (<em>Boolean</em>) &#8211; Set to <code class="docutils literal"><span class="pre">True</span></code> if the fits file is in dsa10 correlator format,
<code class="docutils literal"><span class="pre">False</span></code> if the file is in 6-input correlator format.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>nchan</strong> (<em>int</em>) &#8211; The number of frequency channels.</li>
<li><strong>fobs</strong> (<em>array</em>) &#8211; The midpoint frequency of each channel in GHz.</li>
<li><strong>nt</strong> (<em>int</em>) &#8211; The number of time subintegrations.</li>
<li><strong>blen</strong> (<em>ndarray</em>) &#8211; The ITRF coordinates of the baselines, shape (nbaselines, 3).</li>
<li><strong>bname</strong> (<em>list</em>) &#8211; The station pairs for each baseline (in the same order as blen), shape
(nbaselines, 2).</li>
<li><strong>tstart</strong> (<em>float</em>) &#8211; The start time. If <cite>dsa10</cite> is set to <code class="docutils literal"><span class="pre">True</span></code>, <cite>tstart</cite> is the start
time in MJD. If <cite>dsa10</cite> is set to <code class="docutils literal"><span class="pre">False</span></code>, <cite>tstart</cite> is the start time
in seconds past the utc start time of the correlator run.</li>
<li><strong>tstop</strong> (<em>float</em>) &#8211; The stop time. If <cite>dsa10</cite> is set to <code class="docutils literal"><span class="pre">True</span></code>, <cite>tstart</cite> is the stop time
in MJD. If <cite>dsa10</cite> is set to <code class="docutils literal"><span class="pre">False</span></code>, <cite>tstart</cite> is the stop time in
seconds past the utc start time of the correlator run.</li>
<li><strong>tsamp</strong> (<em>float</em>) &#8211; The sampling time in seconds.</li>
<li><strong>aname</strong> (<em>list</em>) &#8211; The antenna names, in the order they are in in the visibilities.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.fits_io.read_psrfits_file">
<code class="descclassname">dsacalib.fits_io.</code><code class="descname">read_psrfits_file</code><span class="sig-paren">(</span><em>fl</em>, <em>source</em>, <em>dur=&lt;Quantity 50. min&gt;</em>, <em>antenna_order=None</em>, <em>antpos=None</em>, <em>utc_start=None</em>, <em>autocorrs=False</em>, <em>badants=None</em>, <em>quiet=True</em>, <em>dsa10=True</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.fits_io.read_psrfits_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads in the psrfits header and data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fl</strong> (<em>str</em>) &#8211; The full path to the psrfits file.</li>
<li><strong>source</strong> (<em>src class instance</em>) &#8211; The source to retrieve data for.</li>
<li><strong>dur</strong> (<em>astropy quantity in minutes or equivalent</em>) &#8211; The amount of time to extract around the source meridian passing.
Defaults <code class="docutils literal"><span class="pre">50*u.min</span></code>.</li>
<li><strong>antenna_order</strong> (<em>list</em>) &#8211; The order of the antennas in the correlator.  Only used if dsa10 is set
to <code class="docutils literal"><span class="pre">False</span></code>.  Defaults <code class="docutils literal"><span class="pre">None</span></code>.</li>
<li><strong>antpos</strong> (<em>str</em>) &#8211; The full path of the text file containing the antenna ITRF positions.
Defaults <cite>dsacalib.constants.PKG_DATA_PATH</cite>/antpos_ITRF.txt.</li>
<li><strong>utc_start</strong> (<em>astropy time object</em>) &#8211; The start time of the observation in UTC.  Only used if dsa10 is set to
<code class="docutils literal"><span class="pre">False</span></code>. Defaults <code class="docutils literal"><span class="pre">None</span></code>.</li>
<li><strong>autocorrs</strong> (<em>boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">True</span></code>, both auto and cross correlations will be returned.
If set to False, only the cross correlations will be returned. Defaults
<code class="docutils literal"><span class="pre">False</span></code>.</li>
<li><strong>badants</strong> (<em>list(int)</em>) &#8211; The antennas for which you do not want data to be returned. If set to
<code class="docutils literal"><span class="pre">None</span></code>, all antennas are returned.  Defaults <code class="docutils literal"><span class="pre">None</span></code>.</li>
<li><strong>quiet</strong> (<em>boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">True</span></code>, infromation on the file printed to stdout.</li>
<li><strong>dsa10</strong> (<em>boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">True</span></code>, assumes fits file is in dsa10 format, otherwise
assumes fits file is in the 3-antenna correlator output format.
Defaults <code class="docutils literal"><span class="pre">True</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>fobs</strong> (<em>array</em>) &#8211; The frequency of the channels in GHz.</li>
<li><strong>blen</strong> (<em>array</em>) &#8211; The itrf coordinates of the baselines, shape (nbaselines, 3).</li>
<li><strong>bname</strong> (<em>list</em>) &#8211; The station pairs for each baseline (in the same order as blen). Shape
(nbaselines, 2).</li>
<li><strong>tstart</strong> (<em>float</em>) &#8211; The start time of the extracted data in MJD.</li>
<li><strong>tstop</strong> (<em>float</em>) &#8211; The stop time of the extracted data in MJD.</li>
<li><strong>tsamp</strong> (<em>float</em>) &#8211; The sampling time in seconds.</li>
<li><strong>vis</strong> (<em>ndarray</em>) &#8211; The requested visibilities, dimensions (baseline, time, frequency,
polarization).</li>
<li><strong>mjd</strong> (<em>array</em>) &#8211; The midpoint MJD of each subintegration in the visibilities.</li>
<li><strong>lst</strong> (<em>array</em>) &#8211; The midpoint LST of each subintegration in the visibilities.</li>
<li><strong>transit_idx</strong> (<em>int</em>) &#8211; The index of the meridian passing in the time axis of the visibilities.</li>
<li><strong>antenna_order</strong> (<em>list</em>) &#8211; The antenna indices, in the order that they are in in the visibilities.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-dsacalib.fringestopping">
<span id="dsacalib-fringestopping-module"></span><h2>dsacalib.fringestopping module<a class="headerlink" href="#module-dsacalib.fringestopping" title="Permalink to this headline">¶</a></h2>
<p>Functions used in fringestopping of DSA-110 visibilities.</p>
<p>Author: Dana Simard, <a class="reference external" href="mailto:dana&#46;simard&#37;&#52;&#48;astro&#46;caltech&#46;edu">dana<span>&#46;</span>simard<span>&#64;</span>astro<span>&#46;</span>caltech<span>&#46;</span>edu</a> 11/2019</p>
<p>These functions use casatools to build sky models, divide visibilities by sky
models, and fringestop visibilities.</p>
<dl class="function">
<dt id="dsacalib.fringestopping.amplitude_sky_model">
<code class="descclassname">dsacalib.fringestopping.</code><code class="descname">amplitude_sky_model</code><span class="sig-paren">(</span><em>source</em>, <em>ant_ra</em>, <em>pt_dec</em>, <em>fobs</em>, <em>dish_dia=4.65</em>, <em>spind=0.7</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.fringestopping.amplitude_sky_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the amplitude sky model due to the primary beam.</p>
<p>Computes the amplitude sky model for a single source due to the primary
beam response of an antenna.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>source</strong> (<em>src class instance</em>) &#8211; The source to model.  The source flux (<cite>src.I</cite>), right ascension
(<cite>src.ra</cite>) and declination (<cite>src.dec</cite>) must be specified.</li>
<li><strong>ant_ra</strong> (<em>ndarray</em>) &#8211; The right ascension pointing of the antenna in each time bin of the
observation, in radians.  If az=0 deg or az=180 deg, this is the lst of
each time bin in the observation in radians.</li>
<li><strong>pt_dec</strong> (<em>float</em>) &#8211; The pointing declination of the observation in radians.</li>
<li><strong>fobs</strong> (<em>array</em>) &#8211; The observing frequency of the center of each channel in GHz.</li>
<li><strong>dish_dia</strong> (<em>float</em>) &#8211; The dish diameter in m.  Defaults 4.65.</li>
<li><strong>spind</strong> (<em>float</em>) &#8211; The spectral index of the source.  Defaults 0.7.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The calculated amplitude sky model.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarray</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.fringestopping.calc_uvw">
<code class="descclassname">dsacalib.fringestopping.</code><code class="descname">calc_uvw</code><span class="sig-paren">(</span><em>blen</em>, <em>tobs</em>, <em>src_epoch</em>, <em>src_lon</em>, <em>src_lat</em>, <em>obs='OVRO_MMA'</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.fringestopping.calc_uvw" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates uvw coordinates.</p>
<p>Uses CASA to calculate the u,v,w coordinates of the baselines <cite>b</cite> towards a
source or phase center (specified by <cite>src_epoch</cite>, <cite>src_lon</cite> and <cite>src_lat</cite>)
at the specified time and observatory.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>blen</strong> (<em>ndarray</em>) &#8211; The ITRF coordinates of the baselines.  Type float, shape (nbaselines,
3), units of meters.</li>
<li><strong>tobs</strong> (<em>ndarray</em>) &#8211; An array of floats, the times in MJD for which to calculate the uvw
coordinates.</li>
<li><strong>src_epoch</strong> (<em>str</em>) &#8211; The epoch of the source or phase-center, as a CASA-recognized string
e.g. <code class="docutils literal"><span class="pre">'J2000'</span></code> or <code class="docutils literal"><span class="pre">'HADEC'</span></code></li>
<li><strong>src_lon</strong> (<em>astropy quantity</em>) &#8211; The longitude of the source or phase-center, in degrees or an
equivalent unit.</li>
<li><strong>src_lat</strong> (<em>astropy quantity</em>) &#8211; The latitude of the source or phase-center, in degrees or an equivalent
unit.</li>
<li><strong>obs</strong> (<em>string</em>) &#8211; The name of the observatory in CASA.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>bu</strong> (<em>ndarray</em>) &#8211; The u-value for each time and baseline, in meters. Shape is
<code class="docutils literal"><span class="pre">(len(b),</span> <span class="pre">len(tobs))</span></code>.</li>
<li><strong>bv</strong> (<em>ndarray</em>) &#8211; The v-value for each time and baseline, in meters. Shape is
<code class="docutils literal"><span class="pre">(len(b),</span> <span class="pre">len(tobs))</span></code>.</li>
<li><strong>bw</strong> (<em>ndarray</em>) &#8211; The w-value for each time and baseline, in meters. Shape is
<code class="docutils literal"><span class="pre">(len(b),</span> <span class="pre">len(tobs))</span></code>.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.fringestopping.complex_sky_model">
<code class="descclassname">dsacalib.fringestopping.</code><code class="descname">complex_sky_model</code><span class="sig-paren">(</span><em>source</em>, <em>ant_ra</em>, <em>pt_dec</em>, <em>fobs</em>, <em>tobs</em>, <em>blen</em>, <em>dish_dia=4.65</em>, <em>spind=0.7</em>, <em>pointing_ra=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.fringestopping.complex_sky_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the complex sky model, taking into account pointing errors.</p>
<p>Use when the pointing error is large enough to introduce a phase error in
the visibilities if not properly accounted for.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>source</strong> (<em>src class instance</em>) &#8211; The source to model.  The source flux (<cite>src.I</cite>), right ascension
(<cite>src.ra</cite>) and declination (<cite>src.dec</cite>) must be specified.</li>
<li><strong>ant_ra</strong> (<em>ndarray</em>) &#8211; The right ascension pointing of the antenna in each time bin of the
observation, in radians.  If az=0 deg or az=180 deg, this is the lst of
each time bin in the observation in radians.</li>
<li><strong>pt_dec</strong> (<em>float</em>) &#8211; The pointing declination of the observation in radians.</li>
<li><strong>fobs</strong> (<em>array</em>) &#8211; The observing frequency of the center of each channel in GHz.</li>
<li><strong>tobs</strong> (<em>array</em>) &#8211; The observing time of the center of each timebin in MJD.</li>
<li><strong>blen</strong> (<em>ndarray</em>) &#8211; The ITRF dimensions of each baseline, in m.</li>
<li><strong>dish_dia</strong> (<em>float</em>) &#8211; The dish diameter in m.  Defaults 4.65.</li>
<li><strong>spind</strong> (<em>float</em>) &#8211; The spectral index of the source.  Defaults 0.7.</li>
<li><strong>pt_ra</strong> (<em>float</em>) &#8211; The pointing (either physically or through fringestopping) right
ascension in radians. If None, defaults to the pointing of the antenna,
<cite>ant_ra</cite>. In other words, assumes fringestopping on the meridian.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The calculated complex sky model.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarray</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.fringestopping.divide_visibility_sky_model">
<code class="descclassname">dsacalib.fringestopping.</code><code class="descname">divide_visibility_sky_model</code><span class="sig-paren">(</span><em>vis</em>, <em>blen</em>, <em>sources</em>, <em>tobs</em>, <em>fobs</em>, <em>lst</em>, <em>pt_dec</em>, <em>return_model=False</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.fringestopping.divide_visibility_sky_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates and applies the sky model visibilities.</p>
<p>Calculates the sky model visibilities on the baselines <cite>blen</cite> and at times
<cite>tobs</cite>.  Divides the input visibilities, <cite>vis</cite>, by the sky model. <cite>vis</cite> is
modified in-place.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>vis</strong> (<em>ndarray</em>) &#8211; The observed complex visibilities, with dimensions (baselines, time,
frequency, polarization).  <cite>vis</cite> will be updated in place to the
fringe-stopped visibilities</li>
<li><strong>blen</strong> (<em>ndarray</em>) &#8211; The baselines for which to calculate visibilities, shape (nbaselines,
3), units of meters in ITRF coords.</li>
<li><strong>sources</strong> (<em>list(src class objects)</em>) &#8211; The list of sources to include in the sky model.</li>
<li><strong>tobs</strong> (<em>float or ndarray</em>) &#8211; The times for which to calculate the visibility model in MJD.</li>
<li><strong>fobs</strong> (<em>float or arr(float)</em>) &#8211; The frequency for which to calculate the model in GHz.</li>
<li><strong>lst</strong> (<em>fload or ndarray</em>) &#8211; The lsts at which to calculate the visibility model.</li>
<li><strong>pt_dec</strong> (<em>float</em>) &#8211; The pointing declination in radians.</li>
<li><strong>return_model</strong> (<em>boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">True</span></code>, the visibility model will be returned. Defaults to
<code class="docutils literal"><span class="pre">False</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>vis_model</strong> &#8211; The modelled visibilities, dimensions (baselines, time, frequency,
polarization). Returned only if <cite>return_model</cite> is set to True.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarray</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.fringestopping.fringestop">
<code class="descclassname">dsacalib.fringestopping.</code><code class="descname">fringestop</code><span class="sig-paren">(</span><em>vis</em>, <em>blen</em>, <em>source</em>, <em>tobs</em>, <em>fobs</em>, <em>pt_dec</em>, <em>return_model=False</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.fringestopping.fringestop" title="Permalink to this definition">¶</a></dt>
<dd><p>Fringestops on a source.</p>
<p>Fringestops on a source (or sky position) by dividing the input
visibilities by a phase only model.  The input visibilities, vis, are
modified in place.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>vis</strong> (<em>ndarray</em>) &#8211; The visibilities t be fringestopped, with dimensions (baselines, time,
freq, pol). <cite>vis</cite> is modified in place.</li>
<li><strong>blen</strong> (<em>ndarray</em>) &#8211; The ITRF coordinates of the baselines in meters, with dimensions (3,
baselines).</li>
<li><strong>source</strong> (<em>src class instance</em>) &#8211; The source to fringestop on.</li>
<li><strong>tobs</strong> (<em>ndarray</em>) &#8211; The observation time (the center of each bin) in MJD.</li>
<li><strong>fobs</strong> (<em>ndarray</em>) &#8211; The observing frequency (the center of each bin) in GHz.</li>
<li><strong>pt_dec</strong> (<em>float</em>) &#8211; The pointing declination of the array, in radians.</li>
<li><strong>return_model</strong> (<em>boolean</em>) &#8211; If <code class="docutils literal"><span class="pre">True</span></code>, the fringestopping model is returned.  Defaults <code class="docutils literal"><span class="pre">False</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>vis_model</strong> &#8211; The phase-only visibility model by which the visiblities were divided.
Returned only if <cite>return_model</cite> is set to <code class="docutils literal"><span class="pre">True</span></code>.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarray</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.fringestopping.pb_resp">
<code class="descclassname">dsacalib.fringestopping.</code><code class="descname">pb_resp</code><span class="sig-paren">(</span><em>ant_ra</em>, <em>ant_dec</em>, <em>src_ra</em>, <em>src_dec</em>, <em>freq</em>, <em>dish_dia=4.34</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.fringestopping.pb_resp" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the primary beam response towards a direction on the sky.</p>
<p>Assumes tapered illumination of the disk. Returns a value between 0 and 1
for each value passed in <cite>ant_ra</cite>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ant_ra</strong> (<em>float or ndarray</em>) &#8211; The antenna right ascension pointing in radians.  If an array, must be
one-dimensional.</li>
<li><strong>ant_dec</strong> (<em>float</em>) &#8211; The antenna declination pointing in radians.</li>
<li><strong>src_ra</strong> (<em>float</em>) &#8211; The source right ascension in radians.</li>
<li><strong>src_dec</strong> (<em>float</em>) &#8211; The source declination in radians.</li>
<li><strong>freq</strong> (<em>ndarray</em>) &#8211; The frequency of each channel in GHz.</li>
<li><strong>dish_dia</strong> (<em>float</em>) &#8211; The dish diameter in meters.  Defaults to <code class="docutils literal"><span class="pre">4.65</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>pb</strong> &#8211; The primary beam response, dimensions (<cite>ant_ra</cite>, <cite>freq</cite>) if an array is
passed to <cite>ant_ra</cite>, or (<cite>freq</cite>) if a float is passed to <cite>ant_ra</cite>.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarray</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.fringestopping.pb_resp_uniform_ill">
<code class="descclassname">dsacalib.fringestopping.</code><code class="descname">pb_resp_uniform_ill</code><span class="sig-paren">(</span><em>ant_ra</em>, <em>ant_dec</em>, <em>src_ra</em>, <em>src_dec</em>, <em>freq</em>, <em>dish_dia=4.65</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.fringestopping.pb_resp_uniform_ill" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the primary beam response towards a direction on the sky.</p>
<p>Assumes uniform illumination of the disk. Returns a value between 0 and 1
for each value passed in <cite>ant_ra</cite>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ant_ra</strong> (<em>float or ndarray</em>) &#8211; The antenna right ascension pointing in radians.  If an array, must be
one-dimensional.</li>
<li><strong>ant_dec</strong> (<em>float</em>) &#8211; The antenna declination pointing in radians.</li>
<li><strong>src_ra</strong> (<em>float</em>) &#8211; The source right ascension in radians.</li>
<li><strong>src_dec</strong> (<em>float</em>) &#8211; The source declination in radians.</li>
<li><strong>freq</strong> (<em>ndarray</em>) &#8211; The frequency of each channel in GHz.</li>
<li><strong>dish_dia</strong> (<em>float</em>) &#8211; The dish diameter in meters.  Defaults to <code class="docutils literal"><span class="pre">4.65</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>pb</strong> &#8211; The primary beam response, dimensions (<cite>ant_ra</cite>, <cite>freq</cite>).</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarray</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.fringestopping.set_dimensions">
<code class="descclassname">dsacalib.fringestopping.</code><code class="descname">set_dimensions</code><span class="sig-paren">(</span><em>fobs=None</em>, <em>tobs=None</em>, <em>blen=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.fringestopping.set_dimensions" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the dimensions of arrays for fringestopping.</p>
<p>Ensures that <cite>fobs</cite>, <cite>tobs</cite> and <cite>blen</cite> are ndarrays with the correct
dimensions for fringestopping using jit.  Any combination of these arrays
may be passed.  If no arrays are passed, an empty list is returned</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fobs</strong> (<em>float or ndarray</em>) &#8211; The central frequency of each channel in GHz.  Defaults <code class="docutils literal"><span class="pre">None</span></code>.</li>
<li><strong>tobs</strong> (<em>float or ndarray</em>) &#8211; The central time of each subintegration in MJD.  Defaults <code class="docutils literal"><span class="pre">None</span></code>.</li>
<li><strong>blen</strong> (<em>ndarray</em>) &#8211; The baselines in ITRF coordinates with dimensions (nbaselines, 3) or
(3) if a single baseline.  Defaults <code class="docutils literal"><span class="pre">None</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>A list of the arrays passed, altered to contain the correct dimensions
for fringestopping.  The list may contain:</p>
<dl class="docutils">
<dt>fobs</dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">ndarray</span><dd><p class="first last">The central frequency of each channel in GHz with dimensions
(channels, 1). Included if <cite>fobs</cite> is not set to <code class="docutils literal"><span class="pre">None</span></code>.</p>
</dd>
<dt>tobs</dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">ndarray</span><dd><p class="first last">The central time of each subintegration in MJD with dimensions
(time). Included if <cite>tobs</cite> is not set to <code class="docutils literal"><span class="pre">None</span></code>.</p>
</dd>
<dt>b</dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">ndarray</span><dd><p class="first last">The baselines in ITRF coordaintes with dimensions (baselines, 3) or
(1, 3) if a single baseline.  Included if <code class="docutils literal"><span class="pre">b</span></code> is not set to None.</p>
</dd>
</dl>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.fringestopping.visibility_sky_model">
<code class="descclassname">dsacalib.fringestopping.</code><code class="descname">visibility_sky_model</code><span class="sig-paren">(</span><em>vis_shape</em>, <em>vis_dtype</em>, <em>blen</em>, <em>sources</em>, <em>tobs</em>, <em>fobs</em>, <em>lst</em>, <em>pt_dec</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.fringestopping.visibility_sky_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the sky model visibilities.</p>
<p>Calculates the sky model visibilities on the baselines <cite>b</cite> and at times
<cite>tobs</cite>.  Ensures that the returned sky model is the same datatype and the
same shape as specified by <cite>vis_shape</cite> and <cite>vis_dtype</cite> to ensure
compatability with jit.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>vis_shape</strong> (<em>tuple</em>) &#8211; The shape of the visibilities: (baselines, time, frequency,
polarization).</li>
<li><strong>vis_dtype</strong> (<em>numpy datatype</em>) &#8211; The datatype of the visibilities.</li>
<li><strong>blen</strong> (<em>real array</em>) &#8211; The baselines to calculate visibilities for, shape (nbaselines, 3),
units of meters in ITRF coords.</li>
<li><strong>sources</strong> (<em>list(src class instances)</em>) &#8211; The sources to include in the sky model.</li>
<li><strong>tobs</strong> (<em>float or ndarray</em>) &#8211; The times at which to calculate the visibility model, in MJD.</li>
<li><strong>fobs</strong> (<em>float or ndarray</em>) &#8211; The frequencies at which to calculate the visibility model, in GHz.</li>
<li><strong>lst</strong> (<em>ndarray</em>) &#8211; The local sidereal time in radians for each time in tobs.</li>
<li><strong>pt_dec</strong> (<em>float</em>) &#8211; The antenna pointing declination in radians.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>vis_model</strong> &#8211; The modelled complex visibilities, dimensions (directions, baselines,
time, frequency, polarization).</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarray</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="dsacalib.fringestopping.visibility_sky_model_worker">
<code class="descclassname">dsacalib.fringestopping.</code><code class="descname">visibility_sky_model_worker</code><a class="headerlink" href="#dsacalib.fringestopping.visibility_sky_model_worker" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds complex sky models.</p>
<p>This is a worker to contain the for loop in the visibility model
calculation using jit. Modifies the input array <cite>vis_model</cite> in place.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>vis_model</strong> (<em>ndarray</em>) &#8211; A placeholder for the output.  A complex array initialized to zeros,
with the same shape as the array of visibilities you wish to model.
Dimensions (baseline, time, freq, polarization).</li>
<li><strong>bws</strong> (<em>ndarray</em>) &#8211; The w component of the baselines towards the phase-center or towards
each source in the sky model.  Dimensions (sources,baselines).</li>
<li><strong>famps</strong> (<em>ndarray</em>) &#8211; The flux of each source at the reference frequency, in Jy.</li>
<li><strong>f0</strong> (<em>float</em>) &#8211; The reference frequency, in GHz.</li>
<li><strong>spec_idx</strong> (<em>float</em>) &#8211; The spectral index for the frequency dependence of the source flux.</li>
<li><strong>fobs</strong> (<em>ndarray</em>) &#8211; The central frequency of each channel of the visibilities, in GHz.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-dsacalib.hdf5_io">
<span id="dsacalib-hdf5-io-module"></span><h2>dsacalib.hdf5_io module<a class="headerlink" href="#module-dsacalib.hdf5_io" title="Permalink to this headline">¶</a></h2>
<p>DSACALIB/HDF5_UTILS.PY</p>
<p>Dana Simard, <a class="reference external" href="mailto:dana&#46;simard&#37;&#52;&#48;astro&#46;caltech&#46;edu">dana<span>&#46;</span>simard<span>&#64;</span>astro<span>&#46;</span>caltech<span>&#46;</span>edu</a>, 10/2019</p>
<p>Routines to interact w/ hdf5 visibilities recorded by DSA-110.</p>
<dl class="function">
<dt id="dsacalib.hdf5_io.initialize_hdf5_file">
<code class="descclassname">dsacalib.hdf5_io.</code><code class="descname">initialize_hdf5_file</code><span class="sig-paren">(</span><em>fhdf</em>, <em>fobs</em>, <em>antenna_order</em>, <em>t0</em>, <em>nbls</em>, <em>nchan</em>, <em>npol</em>, <em>nant</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.hdf5_io.initialize_hdf5_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Initializes the hdf5 file for the fringestopped visibilities.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fhdf</strong> (<em>hdf5 file handler</em>) &#8211; The file to initialize.</li>
<li><strong>fobs</strong> (<em>array</em>) &#8211; The center frequency of each channel in GHz.</li>
<li><strong>antenna_order</strong> (<em>array</em>) &#8211; The order of the antennas in the correlator.</li>
<li><strong>t0</strong> (<em>float</em>) &#8211; The time of the first subintegration in MJ seconds.</li>
<li><strong>nbls</strong> (<em>int</em>) &#8211; The number of baselines in the visibilities.</li>
<li><strong>nchan</strong> (<em>int</em>) &#8211; The number of channels in the visibilities.</li>
<li><strong>npol</strong> (<em>int</em>) &#8211; The number of polarizations in the visibilities.</li>
<li><strong>nant</strong> (<em>int</em>) &#8211; The number of antennas in the visibilities.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>vis_ds</strong> (<em>hdf5 dataset</em>) &#8211; The dataset for the visibilities.</li>
<li><strong>t_ds</strong> (<em>hdf5 dataset</em>) &#8211; The dataset for the times.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.hdf5_io.read_hdf5_file">
<code class="descclassname">dsacalib.hdf5_io.</code><code class="descname">read_hdf5_file</code><span class="sig-paren">(</span><em>fl</em>, <em>source=None</em>, <em>dur=&lt;Quantity 50. min&gt;</em>, <em>autocorrs=True</em>, <em>badants=None</em>, <em>quiet=True</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.hdf5_io.read_hdf5_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads visibilities from a hdf5 file written by dsa110-fringestopping.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fl</strong> (<em>str</em>) &#8211; Full path to the hdf5 file.</li>
<li><strong>source</strong> (<em>source instance</em>) &#8211; The source to extract from the hdf5 file. If set to <code class="docutils literal"><span class="pre">None</span></code>, the
entire file is extracted. Defaults <code class="docutils literal"><span class="pre">None</span></code>.</li>
<li><strong>dur</strong> (<em>astropy quantity</em>) &#8211; The duration of the observation to extract, in minutes or an equivalent
unit. Only used if <cite>source</cite> is not set to <code class="docutils literal"><span class="pre">None</span></code>.  Defaults
<code class="docutils literal"><span class="pre">50*u.min</span></code>.</li>
<li><strong>autocorrs</strong> (<em>Boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">True</span></code>, both the autocorrelations and the crosscorrelations
are extracted from the hdf5 file.  If set to <code class="docutils literal"><span class="pre">False</span></code>, only the
crosscorrelations are extracted.  Defaults <code class="docutils literal"><span class="pre">True</span></code>.</li>
<li><strong>badants</strong> (<em>list</em>) &#8211; Antennas that have been flagged as bad or offline.  If provied,
baselines that include these antennas will not be extracted.  If set to
<code class="docutils literal"><span class="pre">None</span></code>, all baselines in the hdf5 file are extracted.  Defaults
<code class="docutils literal"><span class="pre">None</span></code>.</li>
<li><strong>quiet</strong> (<em>Boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">False</span></code>, information about the file will be printed to
stdout. Defaults <code class="docutils literal"><span class="pre">True</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>fobs</strong> (<em>array</em>) &#8211; The observing frequency of the center of each channel in the
visibilities, in GHz.</li>
<li><strong>blen</strong> (<em>ndarray</em>) &#8211; The ITRF baseline lengths, dimensions (nbaselines, 3).</li>
<li><strong>bname</strong> (<em>list(str)</em>) &#8211; The name of each baseline.</li>
<li><strong>tstart</strong> (<em>float</em>) &#8211; The start time of the extracted visibilities in MJD. If the data does
not contain the specified <code class="docutils literal"><span class="pre">source</span></code>, a value of <code class="docutils literal"><span class="pre">None</span></code> is returned.</li>
<li><strong>tstop</strong> (<em>float</em>) &#8211; The stop time of the extracted visibilities in MJD. If the data does
not contain the specified <code class="docutils literal"><span class="pre">source</span></code>, a value of <code class="docutils literal"><span class="pre">None</span></code> is returned.</li>
<li><strong>vis</strong> (<em>ndarray</em>) &#8211; The extracted visibilities, dimensions (baselines, time, frequency,
polarization).</li>
<li><strong>mjd</strong> (<em>array</em>) &#8211; The time of the center of each timebin in the visibilities, in MJD.</li>
<li><strong>transit_idx</strong> (<em>int</em>) &#8211; The index along the time axis corresponding to the meridian crossing of
the source given by <cite>source</cite>.  If <cite>source</cite> is set to <code class="docutils literal"><span class="pre">None</span></code>, a value
of <code class="docutils literal"><span class="pre">None</span></code> is returned.</li>
<li><strong>antenna_order</strong> (<em>list</em>) &#8211; The antenna names, in the order they are in in the hdf5 visibilities.</li>
<li><strong>tsamp</strong> (<em>float</em>) &#8211; The sampling time in seconds.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-dsacalib.ms_io">
<span id="dsacalib-ms-io-module"></span><h2>dsacalib.ms_io module<a class="headerlink" href="#module-dsacalib.ms_io" title="Permalink to this headline">¶</a></h2>
<p>DSACALIB/MS_IO.PY</p>
<p>Dana Simard, <a class="reference external" href="mailto:dana&#46;simard&#37;&#52;&#48;astro&#46;caltech&#46;edu">dana<span>&#46;</span>simard<span>&#64;</span>astro<span>&#46;</span>caltech<span>&#46;</span>edu</a>, 10/2019</p>
<p>Routines to interact with CASA measurement sets and calibration tables.</p>
<dl class="function">
<dt id="dsacalib.ms_io.T3_initialize_ms">
<code class="descclassname">dsacalib.ms_io.</code><code class="descname">T3_initialize_ms</code><span class="sig-paren">(</span><em>paramfile</em>, <em>msname</em>, <em>tstart</em>, <em>sourcename</em>, <em>ra</em>, <em>dec</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.ms_io.T3_initialize_ms" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize a ms to write correlated data from the T3 system to.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>paramfile</strong> (<em>str</em>) &#8211; The full path to a yaml parameter file. See package data for a
template.</li>
<li><strong>msname</strong> (<em>str</em>) &#8211; The name of the measurement set. Will write to <cite>msdir</cite>/<cite>msname</cite>.ms.
<cite>msdir</cite> is defined in <cite>paramfile</cite>.</li>
<li><strong>tstart</strong> (<em>astropy.time.Time object</em>) &#8211; The start time of the observation.</li>
<li><strong>sourcename</strong> (<em>str</em>) &#8211; The name of the source or field.</li>
<li><strong>ra</strong> (<em>astropy quantity</em>) &#8211; The right ascension of the pointing, units deg or equivalent.</li>
<li><strong>dec</strong> (<em>astropy quantity</em>) &#8211; The declination of the pointing, units deg or equivalent.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.ms_io.average_beamformer_solutions">
<code class="descclassname">dsacalib.ms_io.</code><code class="descname">average_beamformer_solutions</code><span class="sig-paren">(</span><em>fnames</em>, <em>ttime</em>, <em>outdir</em>, <em>corridxs=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.ms_io.average_beamformer_solutions" title="Permalink to this definition">¶</a></dt>
<dd><p>Averages written beamformer solutions.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fnames</strong> (<em>list</em>) &#8211; </li>
<li><strong>ttime</strong> (<em>astropy.time.Time object</em>) &#8211; A time to use in the filename of the solutions, indicating when they
were written or are useful. E.g. the transit time of the most recent
source being averaged over.</li>
<li><strong>outdir</strong> (<em>str</em>) &#8211; The directory in which the beamformer solutions are written, and into
which new solutions should be written.</li>
<li><strong>corridxs</strong> (<em>list</em>) &#8211; The correlator nodes for which to average beamformer solutions.
Defaults to 1 through 16 inclusive.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The names of the written beamformer solutions (one for each correlator
node).</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.ms_io.caltable_to_etcd">
<code class="descclassname">dsacalib.ms_io.</code><code class="descname">caltable_to_etcd</code><span class="sig-paren">(</span><em>msname</em>, <em>calname</em>, <em>caltime</em>, <em>status</em>, <em>pols=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.ms_io.caltable_to_etcd" title="Permalink to this definition">¶</a></dt>
<dd><p>Copies calibration values from delay and gain tables to etcd.</p>
<p>The dictionary passed to etcd should look like: {&#8220;ant_num&#8221;: &lt;i&gt;,
&#8220;time&#8221;: &lt;d&gt;, &#8220;pol&#8221;, [&lt;s&gt;, &lt;s&gt;], &#8220;gainamp&#8221;: [&lt;d&gt;, &lt;d&gt;],
&#8220;gainphase&#8221;: [&lt;d&gt;, &lt;d&gt;], &#8220;delay&#8221;: [&lt;i&gt;, &lt;i&gt;], &#8220;calsource&#8221;: &lt;s&gt;,
&#8220;gaincaltime_offset&#8221;: &lt;d&gt;, &#8220;delaycaltime_offset&#8221;: &lt;d&gt;, &#8216;sim&#8217;: &lt;b&gt;,
&#8216;status&#8217;: &lt;i&gt;}</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The measurement set name, will use solutions created from the
measurement set <cite>msname</cite>.ms.</li>
<li><strong>calname</strong> (<em>str</em>) &#8211; The calibrator name.  Will open the calibration tables
<cite>msname</cite>_`calname`_kcal and <cite>msname</cite>_`calname`_gcal_ant.</li>
<li><strong>caltime</strong> (<em>float</em>) &#8211; The time of calibration transit in mjd.</li>
<li><strong>status</strong> (<em>int</em>) &#8211; The status of the calibration. Decode with dsautils.calstatus.</li>
<li><strong>pols</strong> (<em>list</em>) &#8211; The names of the polarizations. If <code class="docutils literal"><span class="pre">None</span></code>, will be set to
<code class="docutils literal"><span class="pre">['B',</span> <span class="pre">'A']</span></code>. Defaults <code class="docutils literal"><span class="pre">None</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.ms_io.convert_calibrator_pass_to_ms">
<code class="descclassname">dsacalib.ms_io.</code><code class="descname">convert_calibrator_pass_to_ms</code><span class="sig-paren">(</span><em>cal</em>, <em>date</em>, <em>files</em>, <em>duration</em>, <em>msdir='/mnt/data/dsa110/calibration/'</em>, <em>hdf5dir='/mnt/data/dsa110/correlator/'</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.ms_io.convert_calibrator_pass_to_ms" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts hdf5 files near a calibrator pass to a CASA ms.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>cal</strong> (<em>dsacalib.utils.src instance</em>) &#8211; The calibrator source.</li>
<li><strong>date</strong> (<em>str</em>) &#8211; The date (to day precision) of the calibrator pass. e.g. &#8216;2020-10-06&#8217;.</li>
<li><strong>files</strong> (<em>list</em>) &#8211; The hdf5 filenames corresponding to the calibrator pass. These should
be date strings to second precision.
e.g. [&#8216;2020-10-06T12:35:04&#8217;, &#8216;2020-10-06T12:50:04&#8217;]
One ms will be written per filename in <cite>files</cite>. If the length of
<cite>files</cite> is greater than 1, the mss created will be virtualconcated into
a single ms.</li>
<li><strong>duration</strong> (<em>astropy quantity</em>) &#8211; Amount of data to extract, unit minutes or equivalent.</li>
<li><strong>msdir</strong> (<em>str</em>) &#8211; The full path to the directory to place the measurement set in. The ms
will be written to <cite>msdir</cite>/<cite>date</cite>_`cal.name`.ms</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.ms_io.convert_to_ms">
<code class="descclassname">dsacalib.ms_io.</code><code class="descname">convert_to_ms</code><span class="sig-paren">(</span><em>source</em>, <em>vis</em>, <em>obstm</em>, <em>ofile</em>, <em>bname</em>, <em>antenna_order</em>, <em>tsamp=9.663676416000001</em>, <em>nint=1</em>, <em>antpos=None</em>, <em>model=None</em>, <em>dt=0.00042824074625968933</em>, <em>dsa10=True</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.ms_io.convert_to_ms" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes visibilities to an ms.</p>
<p>Uses the casa simulator tool to write the metadata to an ms, then uses the
casa ms tool to replace the visibilities with the observed data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>source</strong> (<em>source class instance</em>) &#8211; The calibrator (or position) used for fringestopping.</li>
<li><strong>vis</strong> (<em>ndarray</em>) &#8211; The complex visibilities, dimensions (baseline, time, channel,
polarization).</li>
<li><strong>obstm</strong> (<em>float</em>) &#8211; The start time of the observation in MJD.</li>
<li><strong>ofile</strong> (<em>str</em>) &#8211; The name for the created ms.  Writes to <cite>ofile</cite>.ms.</li>
<li><strong>bname</strong> (<em>list</em>) &#8211; The list of baselines names in the form [[ant1, ant2],...].</li>
<li><strong>antenna_order</strong> (<em>list</em>) &#8211; The list of the antennas, in CASA ordering.</li>
<li><strong>tsamp</strong> (<em>float</em>) &#8211; The sampling time of the input visibilities in seconds.  Defaults to
the value <cite>tsamp`*`nint</cite> as defined in <cite>dsacalib.constants</cite>.</li>
<li><strong>nint</strong> (<em>int</em>) &#8211; The number of time bins to integrate by before saving to a measurement
set.  Defaults 1.</li>
<li><strong>antpos</strong> (<em>str</em>) &#8211; The full path to the text file containing ITRF antenna positions or the
csv file containing the station positions in longitude and latitude.
Defaults <cite>dsacalib.constants.PKG_DATA_PATH</cite>/antpos_ITRF.txt.</li>
<li><strong>model</strong> (<em>ndarray</em>) &#8211; The visibility model to write to the measurement set (and against which
gain calibration will be done). Must have the same shape as the
visibilities <cite>vis</cite>. If given a value of <code class="docutils literal"><span class="pre">None</span></code>, an array of ones will
be used as the model.  Defaults <code class="docutils literal"><span class="pre">None</span></code>.</li>
<li><strong>dt</strong> (<em>float</em>) &#8211; The offset between the CASA start time and the data start time in days.
Defaults to the value of <cite>casa_time_offset</cite> in <cite>dsacalib.constants</cite>.</li>
<li><strong>dsa10</strong> (<em>boolean</em>) &#8211; Set to <code class="docutils literal"><span class="pre">True</span></code> if the data are from the dsa10 correlator.  Defaults
<code class="docutils literal"><span class="pre">True</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.ms_io.extract_times">
<code class="descclassname">dsacalib.ms_io.</code><code class="descname">extract_times</code><span class="sig-paren">(</span><em>UV</em>, <em>ra</em>, <em>dt</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.ms_io.extract_times" title="Permalink to this definition">¶</a></dt>
<dd><p>Extracts data from specified times from an already open UVData instance.</p>
<p>This is an alternative to opening the file with the times specified using
pyuvdata.UVData.open().</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>UV</strong> (<em>pyuvdata.UVData() instance</em>) &#8211; The UVData instance from which to extract data. Modified in-place.</li>
<li><strong>ra</strong> (<em>float</em>) &#8211; The ra of the source around which to extract data, in radians.</li>
<li><strong>dt</strong> (<em>astropy quantity</em>) &#8211; The amount of data to extract, units seconds or equivalent.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.ms_io.extract_vis_from_ms">
<code class="descclassname">dsacalib.ms_io.</code><code class="descname">extract_vis_from_ms</code><span class="sig-paren">(</span><em>msname</em>, <em>data='data'</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.ms_io.extract_vis_from_ms" title="Permalink to this definition">¶</a></dt>
<dd><p>Extracts visibilities from a CASA measurement set.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The measurement set. Opens <cite>msname</cite>.ms</li>
<li><strong>data</strong> (<em>str</em>) &#8211; The visibilities to extract. Can be <cite>data</cite>, <cite>model</cite> or <cite>corrected</cite>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>vals</strong> (<em>ndarray</em>) &#8211; The visibilities, dimensions (baseline, time, spw, freq, pol).</li>
<li><strong>time</strong> (<em>array</em>) &#8211; The time of each integration in days.</li>
<li><strong>fobs</strong> (<em>array</em>) &#8211; The frequency of each channel in GHz.</li>
<li><strong>flags</strong> (<em>ndarray</em>) &#8211; Flags for the visibilities, same shape as vals. True if flagged.</li>
<li><strong>ant1, ant2</strong> (<em>array</em>) &#8211; The antenna indices for each baselines in the visibilities.</li>
<li><strong>pt_dec</strong> (<em>float</em>) &#8211; The pointing declination of the array. (Note: Not the phase center, but
the physical pointing of the antennas.)</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.ms_io.get_antenna_gains">
<code class="descclassname">dsacalib.ms_io.</code><code class="descname">get_antenna_gains</code><span class="sig-paren">(</span><em>gains</em>, <em>ant1</em>, <em>ant2</em>, <em>refant=0</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.ms_io.get_antenna_gains" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates antenna gains, g_i, from CASA table of G_ij=g_i g_j*.</p>
<p>Currently does not support baseline-based gains.
Refant only used for baseline-based case.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>gains</strong> (<em>ndarray</em>) &#8211; The gains read in from the CASA gain table. 0th axis is baseline or
antenna.</li>
<li><strong>ant2</strong> (<em>ant1,</em>) &#8211; The antenna pair for each entry along the 0th axis in gains.</li>
<li><strong>refant</strong> (<em>int</em>) &#8211; The reference antenna index to use to get antenna gains from baseline
gains.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>antennas</strong> (<em>ndarray</em>) &#8211; The antenna indices.</li>
<li><strong>antenna_gains</strong> (<em>ndarray</em>) &#8211; Gains for each antenna in <cite>antennas</cite>.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.ms_io.get_delays">
<code class="descclassname">dsacalib.ms_io.</code><code class="descname">get_delays</code><span class="sig-paren">(</span><em>antennas</em>, <em>msname</em>, <em>calname</em>, <em>applied_delays</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.ms_io.get_delays" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the delays to be set in the correlator.</p>
<p>Based on the calibrated delays and the currently applied delays.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>antennas</strong> (<em>list</em>) &#8211; The antennas to get delays for.</li>
<li><strong>msname</strong> (<em>str</em>) &#8211; The path to the measurement set containing the calibrator pass.</li>
<li><strong>calname</strong> (<em>str</em>) &#8211; The name of the calibrator. Will open <cite>msname</cite>_`calname`_kcal.</li>
<li><strong>applied_delays</strong> (<em>ndarray</em>) &#8211; The currently applied delays for every antenna/polarization, in ns.
Dimensions (antenna, pol).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>delays</strong> (<em>ndarray</em>) &#8211; The delays to be applied for every antenna/polarization in ns.
Dimensions (antenna, pol).</li>
<li><strong>flags</strong> (<em>ndarray</em>) &#8211; True if that antenna/pol data is flagged in the calibration table.
In this case, the delay should be set to 0. Dimensions (antenna, pol).</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.ms_io.read_caltable">
<code class="descclassname">dsacalib.ms_io.</code><code class="descname">read_caltable</code><span class="sig-paren">(</span><em>tablename</em>, <em>cparam=False</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.ms_io.read_caltable" title="Permalink to this definition">¶</a></dt>
<dd><p>Requires that each spw has the same number of frequency channels.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>tablename</strong> (<em>str</em>) &#8211; The full path to the calibration table.</li>
<li><strong>cparam</strong> (<em>bool</em>) &#8211; If True, reads the column CPARAM in the calibrtion table. Otherwise
reads FPARAM.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>vals</strong> (<em>ndarray</em>) &#8211; The visibilities, dimensions (baseline, time, spw, freq, pol).</li>
<li><strong>time</strong> (<em>array</em>) &#8211; The time of each integration in days.</li>
<li><strong>flags</strong> (<em>ndarray</em>) &#8211; Flags for the visibilities, same shape as vals. True if flagged.</li>
<li><strong>ant1, ant2</strong> (<em>array</em>) &#8211; The antenna indices for each baselines in the visibilities.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.ms_io.reshape_calibration_data">
<code class="descclassname">dsacalib.ms_io.</code><code class="descname">reshape_calibration_data</code><span class="sig-paren">(</span><em>vals</em>, <em>flags</em>, <em>ant1</em>, <em>ant2</em>, <em>baseline</em>, <em>time</em>, <em>spw</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.ms_io.reshape_calibration_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Reshape calibration or measurement set data.</p>
<p>Reshapes the 0th axis of the input data <cite>vals</cite> and <cite>flags</cite> from a
combined (baseline-time-spw) axis into 3 axes (baseline, time, spw).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>vals</strong> (<em>ndarray</em>) &#8211; The input values, shape (baseline-time-spw, freq, pol).</li>
<li><strong>flags</strong> (<em>ndarray</em>) &#8211; Flag array, same shape as vals.</li>
<li><strong>ant2</strong> (<em>ant1,</em>) &#8211; The antennas in the baseline, same length as the 0th axis of <cite>vals</cite>.</li>
<li><strong>baseline</strong> (<em>array</em>) &#8211; The baseline index, same length as the 0th axis of <cite>vals</cite>.</li>
<li><strong>time</strong> (<em>array</em>) &#8211; The time of each integration, same length as the 0th axis of <cite>vals</cite>.</li>
<li><strong>spw</strong> (<em>array</em>) &#8211; The spectral window index of each integration, same length as the 0th
axis of <cite>vals</cite>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>time</strong> (<em>array</em>) &#8211; Unique times, same length as the time axis of the output <cite>vals</cite>.</li>
<li><strong>vals, flags</strong> (<em>ndarray</em>) &#8211; The reshaped input arrays, dimensions (baseline, time, spw, freq, pol)</li>
<li><strong>ant1, ant2</strong> (<em>array</em>) &#8211; ant1 and ant2 for unique baselines, same length as the baseline axis of
the output <cite>vals</cite>.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.ms_io.simulate_ms">
<code class="descclassname">dsacalib.ms_io.</code><code class="descname">simulate_ms</code><span class="sig-paren">(</span><em>ofile</em>, <em>tname</em>, <em>anum</em>, <em>xx</em>, <em>yy</em>, <em>zz</em>, <em>diam</em>, <em>mount</em>, <em>pos_obs</em>, <em>spwname</em>, <em>freq</em>, <em>deltafreq</em>, <em>freqresolution</em>, <em>nchannels</em>, <em>integrationtime</em>, <em>obstm</em>, <em>dt</em>, <em>source</em>, <em>stoptime</em>, <em>autocorr</em>, <em>fullpol</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.ms_io.simulate_ms" title="Permalink to this definition">¶</a></dt>
<dd><p>Simulates a measurement set with cross-correlations only.</p>
<p>WARNING: Not simulating autocorrelations correctly regardless of inclusion
of autocorr parameter.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ofile</strong> (<em>str</em>) &#8211; The full path to which the measurement set will be written.</li>
<li><strong>tname</strong> (<em>str</em>) &#8211; The telescope name.</li>
<li><strong>yy, zz</strong> (<em>xx,</em>) &#8211; The X, Y and Z ITRF coordinates of the antennas, in meters.</li>
<li><strong>diam</strong> (<em>float</em>) &#8211; The dish diameter in meters.</li>
<li><strong>mount</strong> (<em>str</em>) &#8211; The mount type, e.g. &#8216;alt-az&#8217;.</li>
<li><strong>pos_obs</strong> (<em>CASA measure instance</em>) &#8211; The location of the observatory.</li>
<li><strong>spwname</strong> (<em>str</em>) &#8211; The name of the spectral window, e.g. &#8216;L-band&#8217;.</li>
<li><strong>freq</strong> (<em>str</em>) &#8211; The central frequency, as a CASA-recognized string, e.g. &#8216;1.4GHz&#8217;.</li>
<li><strong>deltafreq</strong> (<em>str</em>) &#8211; The size of each channel, as a CASA-recognized string, e.g. &#8216;1.24kHz&#8217;.</li>
<li><strong>freqresolution</strong> (<em>str</em>) &#8211; The frequency resolution, as a CASA-recognized string, e.g. &#8216;1.24kHz&#8217;.</li>
<li><strong>nchannels</strong> (<em>int</em>) &#8211; The number of frequency channels.</li>
<li><strong>integrationtime</strong> (<em>str</em>) &#8211; The subintegration time, i.e. the width of each time bin, e.g. &#8216;1.4s&#8217;.</li>
<li><strong>obstm</strong> (<em>float</em>) &#8211; The start time of the observation in MJD.</li>
<li><strong>dt</strong> (<em>float</em>) &#8211; The offset between the CASA start time and the true start time in days.</li>
<li><strong>source</strong> (<em>dsacalib.utils.source instance</em>) &#8211; The source observed (or the phase-center).</li>
<li><strong>stoptime</strong> (<em>float</em>) &#8211; The end time of the observation in MJD. DS: should be s?</li>
<li><strong>autocorr</strong> (<em>boolean</em>) &#8211; Set to <code class="docutils literal"><span class="pre">True</span></code> if the visibilities include autocorrelations, <code class="docutils literal"><span class="pre">False</span></code>
if the only include crosscorrelations.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.ms_io.uvh5_to_ms">
<code class="descclassname">dsacalib.ms_io.</code><code class="descname">uvh5_to_ms</code><span class="sig-paren">(</span><em>fname</em>, <em>msname</em>, <em>ra=None</em>, <em>dec=None</em>, <em>dt=None</em>, <em>antenna_list=None</em>, <em>flux=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.ms_io.uvh5_to_ms" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a uvh5 data to a uvfits file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>fname</strong> (<em>str</em>) &#8211; The full path to the uvh5 data file.</li>
<li><strong>msname</strong> (<em>str</em>) &#8211; The name of the ms to write. Data will be written to <cite>msname</cite>.ms</li>
<li><strong>ra</strong> (<em>astropy quantity</em>) &#8211; The RA at which to phase the data. If None, will phase at the meridian
of the center of the uvh5 file.</li>
<li><strong>dec</strong> (<em>astropy quantity</em>) &#8211; The DEC at which to phase the data. If None, will phase at the pointing
declination.</li>
<li><strong>dt</strong> (<em>astropy quantity</em>) &#8211; Duration of data to extract. Default is to extract the entire file.</li>
<li><strong>antenna_list</strong> (<em>list</em>) &#8211; Antennas for which to extract visibilities from the uvh5 file. Default
is to extract all visibilities in the uvh5 file.</li>
<li><strong>flux</strong> (<em>float</em>) &#8211; The flux of the calibrator in Jy. If included, will write a model of
the primary beam response to the calibrator source to the model column
of the ms. If not included, a model of a constant response over
frequency and time will be written instead of the primary beam model.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.ms_io.write_beamformer_solutions">
<code class="descclassname">dsacalib.ms_io.</code><code class="descname">write_beamformer_solutions</code><span class="sig-paren">(</span><em>msname</em>, <em>calname</em>, <em>caltime</em>, <em>antennas</em>, <em>applied_delays</em>, <em>corr_list=array([ 1</em>, <em>2</em>, <em>3</em>, <em>4</em>, <em>5</em>, <em>6</em>, <em>7</em>, <em>8</em>, <em>9</em>, <em>10</em>, <em>11</em>, <em>12</em>, <em>13</em>, <em>14</em>, <em>15</em>, <em>16])</em>, <em>outdir='/home/user/beamformer_weights/'</em>, <em>flagged_antennas=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.ms_io.write_beamformer_solutions" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes beamformer solutions to disk.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The name of the measurement set used for calibration.</li>
<li><strong>calname</strong> (<em>str</em>) &#8211; The name of the calibrator source used for calibration. Will open
tables that start with <cite>msname`_`calname</cite></li>
<li><strong>caltime</strong> (<em>astropy.time.Time object</em>) &#8211; The transit time of the calibrator.</li>
<li><strong>antennas</strong> (<em>list</em>) &#8211; The antenna names for which to write beamformer solutions, in order.</li>
<li><strong>applied_delays</strong> (<em>ndarray</em>) &#8211; The currently applied delays at the time of the calibration, in ns.
Dimensions (antenna, pol). The antenna axis should be in the order
specified by antennas.</li>
<li><strong>corr_list</strong> (<em>list</em>) &#8211; The indices of the correlator machines to write beamformer weights for.
For now, these must be ordered so that the frequencies are contiguous
and they are in the same order or the reverse order as in the ms. The
bandwidth of each correlator is pulled from dsa110-meridian-fs package
data.</li>
<li><strong>flagged_antennas</strong> (<em>list</em>) &#8211; A list of antennas to flag in the beamformer solutions. These antennas
will be given beamformer weights of 0, and delays of 0.</li>
<li><strong>outdir</strong> (<em>str</em>) &#8211; The directory to write the beamformer weights in.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>flags</strong> &#8211; Dimensions (antennas, pols). True where the data is flagged, and should
not be used. Compiled from the ms flags as well as <cite>flagged_antennas</cite>.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarray(boolean)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.ms_io.write_beamformer_weights">
<code class="descclassname">dsacalib.ms_io.</code><code class="descname">write_beamformer_weights</code><span class="sig-paren">(</span><em>msname</em>, <em>calname</em>, <em>caltime</em>, <em>antennas</em>, <em>outdir</em>, <em>corr_list</em>, <em>antenna_flags</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.ms_io.write_beamformer_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes weights for the beamformer.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The prefix of the measurement set.  Will open <cite>msname</cite>.ms</li>
<li><strong>calname</strong> (<em>str</em>) &#8211; The name of the calibrator source.</li>
<li><strong>antennas</strong> (<em>list</em>) &#8211; The names of the antennas to extract solutions for.  Order must be the
same as the order in the beamformer.</li>
<li><strong>outdir</strong> (<em>str</em>) &#8211; The directory to write the beamformer weights in.</li>
<li><strong>corr_list</strong> (<em>list</em>) &#8211; The indices of the correlator machines to write beamformer weights for.
For now, these must be ordered so that the frequencies are contiguous
and they are in the same order or the reverse order as in the ms. The
bandwidth of each correlator is pulled from dsa110-meridian-fs package
data.</li>
<li><strong>antenna_flags</strong> (<em>ndarray(bool)</em>) &#8211; Dimensions (antennas, pols). True where flagged, False otherwise.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>corr_list</strong> (<em>list</em>)</li>
<li><strong>bu</strong> (<em>array</em>) &#8211; The length of the baselines in the u direction for each antenna
relative to antenna 24.</li>
<li><strong>fweights</strong> (<em>ndarray</em>) &#8211; The frequencies corresponding to the beamformer weights, dimensions
(correlator, frequency).</li>
<li><strong>filenames</strong> (<em>list</em>) &#8211; The names of the file containing the beamformer weights.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-dsacalib.plotting">
<span id="dsacalib-plotting-module"></span><h2>dsacalib.plotting module<a class="headerlink" href="#module-dsacalib.plotting" title="Permalink to this headline">¶</a></h2>
<p>Visibility and calibration solution plotting routines.</p>
<p>Plotting routines to visualize the visibilities and
the calibration solutions for DSA-110.</p>
<p>Author: Dana Simard, <a class="reference external" href="mailto:dana&#46;simard&#37;&#52;&#48;astro&#46;caltech&#46;edu">dana<span>&#46;</span>simard<span>&#64;</span>astro<span>&#46;</span>caltech<span>&#46;</span>edu</a>, 10/2019</p>
<dl class="function">
<dt id="dsacalib.plotting.plot_antenna_delays">
<code class="descclassname">dsacalib.plotting.</code><code class="descname">plot_antenna_delays</code><span class="sig-paren">(</span><em>msname</em>, <em>calname</em>, <em>plabels=None</em>, <em>outname=None</em>, <em>show=True</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.plotting.plot_antenna_delays" title="Permalink to this definition">¶</a></dt>
<dd><p>Plots antenna delay variations between two delay calibrations.</p>
<p>Compares the antenna delays used in the calibration solution on the
timescale of the entire calibrator pass (assumed to be in a CASA table
ending in &#8216;kcal&#8217;) to those calculated on a shorter (e.g. 60s) timescale
(assumed to be in a CASA table ending in &#8216;2kcal&#8217;).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The prefix of the measurement set (<cite>msname</cite>.ms), used to identify the
correct delay calibration tables.</li>
<li><strong>calname</strong> (<em>str</em>) &#8211; The calibrator source name, used to identify the correct delay
calibration tables.  The tables <cite>msname</cite>_`calname`_kcal (for a single
delay calculated using the entire calibrator pass) and
<cite>msname</cite>_`calname`_2kcal (for delays calculated on a shorter
timescale) will be opened.</li>
<li><strong>antenna_order</strong> (<em>ndarray</em>) &#8211; The antenna names in order.</li>
<li><strong>outname</strong> (<em>string</em>) &#8211; The base to use for the name of the png file the plot is saved to.  The
plot will be saved to <cite>outname</cite>_antdelays.png.  If <cite>outname</cite> is set to
<code class="docutils literal"><span class="pre">None</span></code>, the plot is not saved.  Defaults <code class="docutils literal"><span class="pre">None</span></code>.</li>
<li><strong>plabels</strong> (<em>list</em>) &#8211; The labels along the polarization axis.  Defaults to [&#8216;B&#8217;, &#8216;A&#8217;].</li>
<li><strong>outname</strong> &#8211; The base to use for the name of the png file the plot is saved to. The
plot will be saved to <cite>outname`_antdelays.png if an outname is provided.
If `outname</cite> is <code class="docutils literal"><span class="pre">None</span></code>, the image is not saved.  Defaults <code class="docutils literal"><span class="pre">None</span></code>.</li>
<li><strong>show</strong> (<em>boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">False</span></code> the plot will be closed after it is generated.
Defaults <code class="docutils literal"><span class="pre">True</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>times</strong> (<em>ndarray</em>) &#8211; The times at which the antenna delays (on short timescales) were
calculated, in MJD.</li>
<li><strong>antenna_delays</strong> (<em>ndarray</em>) &#8211; The delays of the antennas on short timescales, in nanoseconds.
Dimensions (polarization, time, antenna).</li>
<li><strong>kcorr</strong> (<em>ndarray</em>) &#8211; The delay correction calculated using the entire observation time, in
nanoseconds.  Dimensions (polarization, 1, antenna).</li>
<li><strong>antenna_order</strong> (<em>list</em>) &#8211; The antenna indices.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.plotting.plot_autocorr">
<code class="descclassname">dsacalib.plotting.</code><code class="descname">plot_autocorr</code><span class="sig-paren">(</span><em>UV</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.plotting.plot_autocorr" title="Permalink to this definition">¶</a></dt>
<dd><p>Plots autocorrelations from UVData object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>UV</strong> (<em>UVData object</em>) &#8211; The UVData object for which to plot autocorrelations.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.plotting.plot_bandpass">
<code class="descclassname">dsacalib.plotting.</code><code class="descname">plot_bandpass</code><span class="sig-paren">(</span><em>msname</em>, <em>calname</em>, <em>plabels=None</em>, <em>outname=None</em>, <em>show=True</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.plotting.plot_bandpass" title="Permalink to this definition">¶</a></dt>
<dd><p>Plots the bandpass calibration solutions in the bcal table.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The name of the measurement set. Used to identify the calibration table
to plot.</li>
<li><strong>calname</strong> (<em>str</em>) &#8211; The name of the calibrator used in calibration. The calibration table
<cite>msname</cite>_`calname`_bcal is opened.</li>
<li><strong>plabels</strong> (<em>list</em>) &#8211; The labels for the polarizations.  Defaults <code class="docutils literal"><span class="pre">['A',</span> <span class="pre">'B']</span></code>.</li>
<li><strong>outname</strong> (<em>str</em>) &#8211; The base to use for the name of the png file the plot is saved to. The
plot is saved to <cite>outname</cite>_bandpass.png if an <cite>outname</cite> is not set to
<code class="docutils literal"><span class="pre">None</span></code>. If <cite>outname</cite> is set to <code class="docutils literal"><span class="pre">None</span></code>, the plot is not saved.
Defaults <code class="docutils literal"><span class="pre">None</span></code>.</li>
<li><strong>show</strong> (<em>boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">False</span></code>, the plot is closed after it is generated.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>bpass</strong> (<em>ndarray</em>) &#8211; The bandpass solutions, dimensions (antenna or baseline, frequency).</li>
<li><strong>fobs</strong> (<em>array</em>) &#8211; The frequencies at which the bandpass solutions are calculated, in GHz.</li>
<li><strong>labels</strong> (<em>ndarray</em>) &#8211; The antenna or baseline labels along the 0th axis of the bandpass
solutions.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.plotting.plot_bandpass_phases">
<code class="descclassname">dsacalib.plotting.</code><code class="descname">plot_bandpass_phases</code><span class="sig-paren">(</span><em>filenames</em>, <em>antennas</em>, <em>refant=24</em>, <em>outname=None</em>, <em>show=True</em>, <em>msdir='/mnt/data/dsa110/calibration/'</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.plotting.plot_bandpass_phases" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot the bandpass phase observed over multiple calibrators.</p>
<dl class="docutils">
<dt>filenames</dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">dict</span><dd>The details of the calibrator passes to plot.</dd>
<dt>antennas</dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">list</span><dd>The antenna names (as ints) to plot.</dd>
<dt>refant</dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">int</span><dd>The reference antenna to plot phases against.</dd>
<dt>outname</dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">str</span><dd>The base to use for the name of the png file the plot is saved to. The
plot is saved to <cite>outname</cite>_phase.png if <cite>outname</cite> is not <code class="docutils literal"><span class="pre">None</span></code>. If
<cite>outname</cite> is set to <code class="docutils literal"><span class="pre">None,</span> <span class="pre">the</span> <span class="pre">plot</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">saved.</span> <span class="pre">Defaults</span> <span class="pre">`None</span></code>.</dd>
<dt>show</dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">boolean</span><dd>If set to <code class="docutils literal"><span class="pre">False</span></code> the plot is closed after being generated.</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="dsacalib.plotting.plot_calibrated_vis">
<code class="descclassname">dsacalib.plotting.</code><code class="descname">plot_calibrated_vis</code><span class="sig-paren">(</span><em>vis</em>, <em>vis_cal</em>, <em>mjd</em>, <em>fobs</em>, <em>bidx</em>, <em>pol</em>, <em>outname=None</em>, <em>show=True</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.plotting.plot_calibrated_vis" title="Permalink to this definition">¶</a></dt>
<dd><p>Plots the calibrated and uncalibrated visibilities for comparison.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>vis</strong> (<em>ndarray</em>) &#8211; The complex, uncalibrated visibilities, with dimensions
(baseline, time, freq, pol).</li>
<li><strong>vis_cal</strong> (<em>ndarray</em>) &#8211; The complex calibrated visibilities, with dimensions
(baseline, time, freq, pol).</li>
<li><strong>mjd</strong> (<em>ndarray</em>) &#8211; The midpoint time of each subintegration in MJD.</li>
<li><strong>fobs</strong> (<em>ndarray</em>) &#8211; The center frequency of each channel in GHz.</li>
<li><strong>bidx</strong> (<em>int</em>) &#8211; The index along the baseline dimension to plot.</li>
<li><strong>pol</strong> (<em>int</em>) &#8211; The index along the polarization dimension to plot.</li>
<li><strong>outname</strong> (<em>str</em>) &#8211; The base to use for the name of the png file the plot is saved to.  The
plot will be saved to <cite>outname`_cal_vis.png if `outname</cite> is provided,
otherwise no plot will be saved.  Defaults <code class="docutils literal"><span class="pre">None</span></code>.</li>
<li><strong>show</strong> (<em>boolean</em>) &#8211; If <cite>show</cite> is passed <code class="docutils literal"><span class="pre">False</span></code>, the plot will be closed after being
generated.  Otherwise, it is left open.  Defaults <code class="docutils literal"><span class="pre">True</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.plotting.plot_current_beamformer_solutions">
<code class="descclassname">dsacalib.plotting.</code><code class="descname">plot_current_beamformer_solutions</code><span class="sig-paren">(</span><em>filenames</em>, <em>calname</em>, <em>date</em>, <em>corrlist=array([ 1</em>, <em>2</em>, <em>3</em>, <em>4</em>, <em>5</em>, <em>6</em>, <em>7</em>, <em>8</em>, <em>9</em>, <em>10</em>, <em>11</em>, <em>12</em>, <em>13</em>, <em>14</em>, <em>15</em>, <em>16])</em>, <em>antennas_to_plot=None</em>, <em>antennas=None</em>, <em>outname=None</em>, <em>show=True</em>, <em>gaindir='/home/user/beamformer_weights/'</em>, <em>hdf5dir='/mnt/data/dsa110/correlator/'</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.plotting.plot_current_beamformer_solutions" title="Permalink to this definition">¶</a></dt>
<dd><p>Plots the phase difference between the two polarizations.</p>
<p>Applies the beamformer weights to the given hdf5 files, and then plots the
remaining phase difference between the two polarizations for each antenna.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>filenames</strong> (<em>list</em>) &#8211; A list of the hdf5 filenames for which to plot. Each filename should
omit the directory and the .hdf5 extension. E.g.
<cite>[&#8216;2020-10-06T15:32:01&#8217;, &#8216;2020-10-06T15:47:01&#8217;]</cite> would a valid
argument to plot data for 30 minutes starting at 2020-10-06T16:32:01.</li>
<li><strong>calname</strong> (<em>str</em>) &#8211; The name of the source or event that you are plotting. Used in the
title of the plot.</li>
<li><strong>date</strong> (<em>str</em>) &#8211; The date of the source or event that you are plotting. Used in the
title of the plot. e.g. &#8216;2020-10-06&#8217;</li>
<li><strong>corrlist</strong> (<em>list(int)</em>) &#8211; A list of the correlator indices to plot.  Defaults to correlators 01
through 16.</li>
<li><strong>antennas_to_plot</strong> (<em>array(int)</em>) &#8211; The names of the antennas to plot beamformer solutions for. Defaults to
antennas 13 through 35, with 21, 22, 23 omitted.</li>
<li><strong>antennas</strong> (<em>array(int)</em>) &#8211; The names of the antennas for which beamformer solutions were
generated.  Defaults to 24 through 36, 20 through 13 (descending
order), then 36 through 74.  Must be 64 long.</li>
<li><strong>outname</strong> (<em>str</em>) &#8211; The base to use for the name of the png file the plot is saved to. The
plot is saved to <cite>outname</cite>_beamformerweights.png if <cite>outname</cite> is not
<code class="docutils literal"><span class="pre">None</span></code>. f <cite>outname</cite> is set to <code class="docutils literal"><span class="pre">None,</span> <span class="pre">the</span> <span class="pre">plot</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">saved.</span>
<span class="pre">Defaults</span> <span class="pre">`None</span></code>.</li>
<li><strong>show</strong> (<em>boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">False</span></code> the plot is closed after being generated.</li>
<li><strong>gaindir</strong> (<em>str</em>) &#8211; The full path to the directory in which the beamformer weights are
stored.</li>
<li><strong>hdf5dir</strong> (<em>str</em>) &#8211; The full path to the directory in which the correlated hdf5 files are
stored. Files were be searched for in <cite>hdf5dir</cite>/corr??/</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.plotting.plot_delays">
<code class="descclassname">dsacalib.plotting.</code><code class="descname">plot_delays</code><span class="sig-paren">(</span><em>vis_ft</em>, <em>labels</em>, <em>delay_arr</em>, <em>bname</em>, <em>nx=None</em>, <em>outname=None</em>, <em>show=True</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.plotting.plot_delays" title="Permalink to this definition">¶</a></dt>
<dd><p>Plots the visibility amplitude against delay.</p>
<p>For a given visibility Fourier transformed along the frequency axis,
plots the amplitude against delay and calculates the location of the
fringe peak in delay.  Returns the peak delay for each visibility,
which can be used to calculate the antenna delays.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>vis_ft</strong> (<em>ndarray</em>) &#8211; The complex visibilities, dimensions (visibility type, baselines,
delay). Note that the visibilities must have been Fourier transformed
along the frequency axis and scrunched along the time axis before being
passed to <cite>plot_delays</cite>.</li>
<li><strong>labels</strong> (<em>list</em>) &#8211; The labels of the types of visibilities passed.  For example,
<code class="docutils literal"><span class="pre">['uncalibrated',</span> <span class="pre">'calibrated']</span></code>.</li>
<li><strong>delay_arr</strong> (<em>ndarray</em>) &#8211; The center of the delay bins in nanoseconds.</li>
<li><strong>bname</strong> (<em>list</em>) &#8211; The baseline labels.</li>
<li><strong>nx</strong> (<em>int</em>) &#8211; The number of plots to tile along the horizontal axis. If <cite>nx</cite> is
given a value of <code class="docutils literal"><span class="pre">None</span></code>, this is set to the number of baselines or 5,
if there are more than 5 baselines.</li>
<li><strong>outname</strong> (<em>str</em>) &#8211; The base to use for the name of the png file the plot is saved to. The
plot will be saved to <cite>outname`_delays.png if an outname is provided.
If `outname</cite> is given a value of <code class="docutils literal"><span class="pre">None</span></code>, no plot will be saved.
Defaults <code class="docutils literal"><span class="pre">None</span></code>.</li>
<li><strong>show</strong> (<em>boolean</em>) &#8211; If <cite>show</cite> is given a value of <code class="docutils literal"><span class="pre">False</span></code> the plot will be closed.
Otherwise, the plot will be left open. Defaults <code class="docutils literal"><span class="pre">True</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>delays</strong> &#8211; The peak delay for each visibility, in nanoseconds.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarray</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.plotting.plot_dyn_spec">
<code class="descclassname">dsacalib.plotting.</code><code class="descname">plot_dyn_spec</code><span class="sig-paren">(</span><em>vis</em>, <em>fobs</em>, <em>mjd</em>, <em>bname</em>, <em>normalize=False</em>, <em>outname=None</em>, <em>show=True</em>, <em>nx=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.plotting.plot_dyn_spec" title="Permalink to this definition">¶</a></dt>
<dd><p>Plots the dynamic spectrum of the real part of the visibility.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>vis</strong> (<em>ndarray</em>) &#8211; The visibilities to plot.  Dimensions (baseline, time, freq,
polarization).</li>
<li><strong>fobs</strong> (<em>ndarray</em>) &#8211; The center frequency of each channel in GHz.</li>
<li><strong>mjd</strong> (<em>ndarray</em>) &#8211; The center of each subintegration in MJD.</li>
<li><strong>bname</strong> (<em>list</em>) &#8211; The name of each baseline in the visibilities.</li>
<li><strong>normalize</strong> (<em>boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">True</span></code>, the visibilities are normalized before plotting.
Defaults to <code class="docutils literal"><span class="pre">False</span></code>.</li>
<li><strong>outname</strong> (<em>str</em>) &#8211; If provided and not set to <code class="docutils literal"><span class="pre">None</span></code>, the plot will be saved to the file
<cite>outname`_dynspec.png Defaults to ``None`</cite>.</li>
<li><strong>show</strong> (<em>boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">False</span></code> the plot will be closed after rendering. If set to
<code class="docutils literal"><span class="pre">True</span></code> the plot is left open. Defaults to <code class="docutils literal"><span class="pre">True</span></code>.</li>
<li><strong>nx</strong> (<em>int</em>) &#8211; The number of subplots in the horizontal direction of the figure. If
not provided, or set to <code class="docutils literal"><span class="pre">None</span></code>, <cite>nx</cite> is set to the minimum of 5 and
the number of baselines in the visibilities.  Defaults to <code class="docutils literal"><span class="pre">None</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.plotting.plot_gain_calibration">
<code class="descclassname">dsacalib.plotting.</code><code class="descname">plot_gain_calibration</code><span class="sig-paren">(</span><em>msname</em>, <em>calname</em>, <em>plabels=None</em>, <em>outname=None</em>, <em>show=True</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.plotting.plot_gain_calibration" title="Permalink to this definition">¶</a></dt>
<dd><p>Plots the gain calibration solutions from the gacal and gpcal tables.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The name of the measurement set.  Used to identify the gain calibration
tables.</li>
<li><strong>calname</strong> (<em>str</em>) &#8211; The calibrator used in gain calibration.  Used to identify the gain
calibration tables.  The tables <cite>msname</cite>_`calname`_gacal (assumed to
contain the gain amplitude soutions) and <cite>msname</cite>_`calname`_gpcal
(assumed to contain the phase amplitude solutions) will be opened.</li>
<li><strong>plabels</strong> (<em>list</em>) &#8211; The names of the polarizations in the calibration solutions. Defaults
to <code class="docutils literal"><span class="pre">['A',</span> <span class="pre">'B']</span></code>.</li>
<li><strong>outname</strong> (<em>str</em>) &#8211; The base to use for the name of the png file the plot is saved to. The
plot is saved to <cite>outname</cite>_gaincal.png if <cite>outname</cite> is not <code class="docutils literal"><span class="pre">None</span></code>.
If <cite>outname</cite> is set to <code class="docutils literal"><span class="pre">None,</span> <span class="pre">the</span> <span class="pre">plot</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">saved.</span>&#160; <span class="pre">Defaults</span>
<span class="pre">``None</span></code>.</li>
<li><strong>show</strong> (<em>boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">False</span></code> the plot is closed after being generated.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>time_days</strong> (<em>ndarray</em>) &#8211; The times of gain calibration, in days.</li>
<li><strong>gain_amp</strong> (<em>ndarray</em>) &#8211; The gain amplitudes. Dimensions (antenna or baseline, time, pol).</li>
<li><strong>gain_phase</strong> (<em>ndarray</em>) &#8211; The gain phases. Dimensions (antenna or baseline, time, pol).</li>
<li><strong>labels</strong> (<em>ndarray</em>) &#8211; The labels of the antennas or baselines along the 0th axis of the gain
solutions.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.plotting.plot_image">
<code class="descclassname">dsacalib.plotting.</code><code class="descname">plot_image</code><span class="sig-paren">(</span><em>msname</em>, <em>imtype</em>, <em>sr0</em>, <em>verbose=False</em>, <em>outname=None</em>, <em>show=True</em>, <em>npix=256</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.plotting.plot_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Uses CASA to grid and image visibilities.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The prefix of the measurement set name.  Opens <cite>msname</cite>.ms.</li>
<li><strong>imtype</strong> (<em>str</em>) &#8211; The visibilities to image.  Can be &#8216;observed&#8217;, &#8216;corrected&#8217;, or &#8216;model&#8217;.</li>
<li><strong>sr0</strong> (<em>src instance</em>) &#8211; The source to use as the phase center in the image.</li>
<li><strong>verbose</strong> (<em>boolean</em>) &#8211; If <code class="docutils literal"><span class="pre">True</span></code>, information about the image, including the location and
SNR of the peak, are printed.  Default <code class="docutils literal"><span class="pre">False</span></code>.</li>
<li><strong>outname</strong> (<em>str</em>) &#8211; The base to use for the name of the png file the plot is saved to. The
plot will be saved to <cite>outname`_`imtype</cite>.png if an outname is provided.
If <cite>outname</cite> is <code class="docutils literal"><span class="pre">None</span></code>, the image is not saved.  Defaults <code class="docutils literal"><span class="pre">None</span></code>.</li>
<li><strong>show</strong> (<em>boolean</em>) &#8211; If <cite>show</cite> is <code class="docutils literal"><span class="pre">False</span></code>, the plot will be closed after being generated.
Defaults <code class="docutils literal"><span class="pre">True</span></code>.</li>
<li><strong>npix</strong> (<em>int</em>) &#8211; The number of pixels per side to plot in the image. Defaults 256.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.plotting.plot_uv_track">
<code class="descclassname">dsacalib.plotting.</code><code class="descname">plot_uv_track</code><span class="sig-paren">(</span><em>bu</em>, <em>bv</em>, <em>outname=None</em>, <em>show=True</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.plotting.plot_uv_track" title="Permalink to this definition">¶</a></dt>
<dd><p>Plots the uv track provided.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>bu</strong> (<em>ndarray</em>) &#8211; The u-coordinates of the baselines in meters. Dimensions (baselines,
time).</li>
<li><strong>bv</strong> (<em>ndarray</em>) &#8211; The v-coordinates of the baselines in meters. Dimensions (baselines,
time).</li>
<li><strong>outname</strong> (<em>str</em>) &#8211; If provided and not set to <code class="docutils literal"><span class="pre">None</span></code>, the plot will be saved to the file
<cite>outname`_dynspec.png Defaults to ``None`</cite>.</li>
<li><strong>show</strong> (<em>boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">False</span></code> the plot will be closed after rendering.  If set to
<code class="docutils literal"><span class="pre">True</span></code> the plot is left open. Defaults to <code class="docutils literal"><span class="pre">True</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.plotting.plot_vis_freq">
<code class="descclassname">dsacalib.plotting.</code><code class="descname">plot_vis_freq</code><span class="sig-paren">(</span><em>vis</em>, <em>fobs</em>, <em>bname</em>, <em>outname=None</em>, <em>show=True</em>, <em>nx=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.plotting.plot_vis_freq" title="Permalink to this definition">¶</a></dt>
<dd><p>Plots visibilities against frequency.</p>
<p>Creates plots of the amplitude and phase of the visibilities <cite>vis</cite> as a
function of frequency <cite>fobs</cite>. Two separate figures are opened, one for the
amplitude and one for the phases.  If <cite>outname</cite> is passed, these are saved
as <cite>outname</cite>_amp_freq.png and <cite>outname</cite>_phase_freq.png</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>vis</strong> (<em>ndarray</em>) &#8211; The visibilities to plot.  Dimensions (baseline, time, freq,
polarization).</li>
<li><strong>fobs</strong> (<em>ndarray</em>) &#8211; The center frequency of each channel in GHz.</li>
<li><strong>bname</strong> (<em>list</em>) &#8211; The name of each baseline in the visibilities.</li>
<li><strong>outname</strong> (<em>str</em>) &#8211; If provided and not set to <code class="docutils literal"><span class="pre">None</span></code>, the plots will be saved to the
files <cite>outname</cite>_amp_freq.png and <cite>outname</cite>_phase_freq.png Defaults to
<code class="docutils literal"><span class="pre">None</span></code>.</li>
<li><strong>show</strong> (<em>boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">False</span></code> the plot will be closed after rendering.  If set to
<code class="docutils literal"><span class="pre">True</span></code> the plot is left open. Defaults to <code class="docutils literal"><span class="pre">True</span></code>.</li>
<li><strong>nx</strong> (<em>int</em>) &#8211; The number of subplots in the horizontal direction of the figure.  If
not provided, or set to <code class="docutils literal"><span class="pre">None</span></code>, <cite>nx</cite> is set to the minimum of 5 and
the number of baselines in the visibilities.  Defaults to <code class="docutils literal"><span class="pre">None</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.plotting.plot_vis_time">
<code class="descclassname">dsacalib.plotting.</code><code class="descname">plot_vis_time</code><span class="sig-paren">(</span><em>vis</em>, <em>mjd</em>, <em>bname</em>, <em>outname=None</em>, <em>show=True</em>, <em>nx=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.plotting.plot_vis_time" title="Permalink to this definition">¶</a></dt>
<dd><p>Plots visibilities against time of observation.</p>
<p>Creates plots of the amplitude and phase of the visibilities <cite>vis</cite> as the
time of observation <cite>mjd</cite>. Two separate figures are opened, one for the
amplitude and one for the phases.  If <cite>outname</cite> is passed, these are saved
as <cite>outname</cite>_amp_time.png and <cite>outname</cite>_phase_time.png</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>vis</strong> (<em>ndarray</em>) &#8211; The visibilities to plot.  Dimensions (baseline, time, freq,
polarization).</li>
<li><strong>mjd</strong> (<em>ndarray</em>) &#8211; The center of each subintegration in MJD.</li>
<li><strong>bname</strong> (<em>list</em>) &#8211; The name of each baseline in the visibilities.</li>
<li><strong>outname</strong> (<em>str</em>) &#8211; If provided and not set to <code class="docutils literal"><span class="pre">None</span></code>, the plot will be saved to the file
<cite>outname</cite>_dynspec.png Defaults to <code class="docutils literal"><span class="pre">None</span></code>.</li>
<li><strong>show</strong> (<em>boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">False</span></code> the plot will be closed after rendering.  If set to
<code class="docutils literal"><span class="pre">True</span></code> the plot is left open. Defaults to <code class="docutils literal"><span class="pre">True</span></code>.</li>
<li><strong>nx</strong> (<em>int</em>) &#8211; The number of subplots in the horizontal direction of the figure.  If
not provided, or set to <code class="docutils literal"><span class="pre">None</span></code>, <cite>nx</cite> is set to the minimum of 5 and
the number of baselines in the visibilities.  Defaults to <code class="docutils literal"><span class="pre">None</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.plotting.rebin_vis">
<code class="descclassname">dsacalib.plotting.</code><code class="descname">rebin_vis</code><span class="sig-paren">(</span><em>arr</em>, <em>nb1</em>, <em>nb2</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.plotting.rebin_vis" title="Permalink to this definition">¶</a></dt>
<dd><p>Rebins a 2-D array for plotting.</p>
<p>Excess bins along either axis are discarded.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>arr</strong> (<em>ndarray</em>) &#8211; The two-dimensional array to rebin.</li>
<li><strong>nb1</strong> (<em>int</em>) &#8211; The number of bins to rebin by along axis 0.</li>
<li><strong>nb2</strong> (<em>int</em>) &#8211; The number of bins to rebin by along the axis 1.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>arr</strong> &#8211; The rebinned array.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarray</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.plotting.summary_plot">
<code class="descclassname">dsacalib.plotting.</code><code class="descname">summary_plot</code><span class="sig-paren">(</span><em>msname</em>, <em>calname</em>, <em>npol</em>, <em>plabels</em>, <em>antennas</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.plotting.summary_plot" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a summary plot showing the calibration solutions.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The path to the measurement set is <code class="docutils literal"><span class="pre">msname</span></code>.ms.</li>
<li><strong>calname</strong> (<em>str</em>) &#8211; The name of the calibrator. Calibration tables starting with
<code class="docutils literal"><span class="pre">msname</span></code>_``calname`` will be opened.</li>
<li><strong>npol</strong> (<em>int</em>) &#8211; The number of polarization indices. Currently not in use.</li>
<li><strong>plabels</strong> (<em>list</em>) &#8211; The labels of the polarizations.</li>
<li><strong>antennas</strong> (<em>list</em>) &#8211; The antennas to plot.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The handle for the generated figure.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">matplotlib.pyplot.figure</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-dsacalib.preprocess">
<span id="dsacalib-preprocess-module"></span><h2>dsacalib.preprocess module<a class="headerlink" href="#module-dsacalib.preprocess" title="Permalink to this headline">¶</a></h2>
<p>Functions used in preprocessing of hdf5 files.</p>
<p>Prepares hdf5 files written by dsa-meridian-fs for conversion to ms.</p>
<dl class="function">
<dt id="dsacalib.preprocess.first_true">
<code class="descclassname">dsacalib.preprocess.</code><code class="descname">first_true</code><span class="sig-paren">(</span><em>iterable</em>, <em>default=False</em>, <em>pred=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.preprocess.first_true" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the first true value in the iterable.</p>
<p>If no true value is found, returns <code class="docutils literal"><span class="pre">default</span></code>
If <code class="docutils literal"><span class="pre">pred</span></code> is not None, returns the first item
for which pred(item) is true.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>iterable</strong> (<em>list</em>) &#8211; The list for which to find the first True item.</li>
<li><strong>default</strong> &#8211; If not False, then this is returned if no true value is found.
Defaults False.</li>
<li><strong>pred</strong> &#8211; If not None, then the first item for which pred(item) is True is
returned.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.preprocess.fscrunch_file">
<code class="descclassname">dsacalib.preprocess.</code><code class="descname">fscrunch_file</code><span class="sig-paren">(</span><em>fname</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.preprocess.fscrunch_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes outrigger delays before averaging in frequency.</p>
<p>Leaves file untouched if the number of frequency bins is not divisible
by the desired number of frequency bins (NFREQ), or is equal to the desired
number of frequency bins.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>fname</strong> (<em>str</em>) &#8211; The full path to the file to process.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.preprocess.rsync_file">
<code class="descclassname">dsacalib.preprocess.</code><code class="descname">rsync_file</code><span class="sig-paren">(</span><em>rsync_string</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.preprocess.rsync_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Rsyncs a file from the correlator machines to dsastorage.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>rsync_string</strong> (<em>str</em>) &#8211; The correlator machine name and the path to the file to rsync,
separated by a space.
E.g. &#8216;corr06 /home/ubuntu/data/2020-06-24T12:32:06.hdf5&#8217;</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-dsacalib.routines">
<span id="dsacalib-routines-module"></span><h2>dsacalib.routines module<a class="headerlink" href="#module-dsacalib.routines" title="Permalink to this headline">¶</a></h2>
<p>Calibration routine for DSA-110 calibration with CASA.</p>
<p>Author: Dana Simard, <a class="reference external" href="mailto:dana&#46;simard&#37;&#52;&#48;astro&#46;caltech&#46;edu">dana<span>&#46;</span>simard<span>&#64;</span>astro<span>&#46;</span>caltech<span>&#46;</span>edu</a>, 2020/06</p>
<dl class="function">
<dt id="dsacalib.routines.cal_in_datetime">
<code class="descclassname">dsacalib.routines.</code><code class="descname">cal_in_datetime</code><span class="sig-paren">(</span><em>dt</em>, <em>transit_time</em>, <em>duration=&lt;Quantity 5. min&gt;</em>, <em>filelength=&lt;Quantity 15. min&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.routines.cal_in_datetime" title="Permalink to this definition">¶</a></dt>
<dd><p>Check to see if a transit is in a given file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>dt</strong> (<em>str</em>) &#8211; The start time of the file, given as a string.
E.g. &#8216;2020-10-06T23:19:02&#8217;</li>
<li><strong>transit_time</strong> (<em>astropy.time.Time instance</em>) &#8211; The transit time of the source.</li>
<li><strong>duration</strong> (<em>astropy quantity</em>) &#8211; The amount of time around transit you are interested in, in minutes or
seconds.</li>
<li><strong>filelength</strong> (<em>astropy quantity</em>) &#8211; The length of the hdf5 file, in minutes or seconds.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">True if at least part of the transit is within the file, else False.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">bool</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.routines.calculate_sefd">
<code class="descclassname">dsacalib.routines.</code><code class="descname">calculate_sefd</code><span class="sig-paren">(</span><em>msname</em>, <em>cal</em>, <em>fmin=None</em>, <em>fmax=None</em>, <em>baseline_cal=False</em>, <em>showplots=False</em>, <em>msname_delaycal=None</em>, <em>calname_delaycal=None</em>, <em>halfpower=False</em>, <em>pols=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.routines.calculate_sefd" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the SEFD from a measurement set.</p>
<p>The measurement set must have been calibrated against a model of ones and
must include autocorrelations.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The measurement set name.  The measurement set <cite>msname</cite>.ms will
be opened.</li>
<li><strong>cal</strong> (<em>src class instance</em>) &#8211; The calibrator source.  Will be used to identify the correct
calibration tables.  The table <cite>msname</cite>_`cal.name`_gacal will
be opened.</li>
<li><strong>fmin</strong> (<em>float</em>) &#8211; The lowest frequency to consider when calculating the off-source power
to use in the SEFD calculation, in GHz. Channels below this frequency
will be flagged. Defaults 1.35.</li>
<li><strong>fmax</strong> (<em>float</em>) &#8211; The greatest frequency to consider when calculating the off-source
power to use in the SEFD calculation, in GHz.  Channels above this
frequency will be flagged.  Defaults 1.45.</li>
<li><strong>baseline_cal</strong> (<em>Boolean</em>) &#8211; Set to <code class="docutils literal"><span class="pre">True</span></code> if the gain tables were derived using baseline-based
calibration. Set to <code class="docutils literal"><span class="pre">False</span></code> if the gain tables were derived using
antenna-based calibration. Defaults <code class="docutils literal"><span class="pre">True</span></code>.</li>
<li><strong>showplots</strong> (<em>Boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">True</span></code>, plots will be generated that show the Gaussian fits
to the gains. Defaults <code class="docutils literal"><span class="pre">False</span></code>.</li>
<li><strong>msname_delaycal</strong> (<em>str</em>) &#8211; The name of the measurement set from which delay solutions should be
applied. Defaults to <cite>msname</cite>.</li>
<li><strong>calname_delaycal</strong> (<em>str</em>) &#8211; The name of the calibrator source from which delay solutions should be
applied. Defaults to <cite>calname</cite>.</li>
<li><strong>halfpower</strong> (<em>Boolean</em>) &#8211; If True, will calculate the sefd using the half-power point instead of
using the off-source power.  Defaults False.</li>
<li><strong>pols</strong> (<em>list</em>) &#8211; The labels of the polarization axes. Defaults [&#8216;B&#8217;, &#8216;A&#8217;].</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>antenna_names</strong> (<em>list</em>) &#8211; The names of the antennas in their order in <cite>sefds</cite>.</li>
<li><strong>sefds</strong> (<em>ndarray</em>) &#8211; The SEFD of each antenna/polarization pair, in Jy. Dimensions (antenna,
polarization).</li>
<li><strong>ant_gains</strong> (<em>ndarray</em>) &#8211; The antenna gains in 1/Jy. Dimensions (antenna, polarization).</li>
<li><strong>ant_transit_time</strong> (<em>ndarray</em>) &#8211; The meridian transit time of the source as seen by each antenna/
polarization pair, in MJD. Dimensions (antenna, polarization).</li>
<li><strong>fref</strong> (<em>float</em>) &#8211; The reference frequency of the SEFD measurements in GHz.</li>
<li><strong>hwhms</strong> (<em>float</em>) &#8211; The hwhms of the calibrator transits in days.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.routines.calibrate_measurement_set">
<code class="descclassname">dsacalib.routines.</code><code class="descname">calibrate_measurement_set</code><span class="sig-paren">(</span><em>msname</em>, <em>cal</em>, <em>refant</em>, <em>throw_exceptions=True</em>, <em>bad_antennas=None</em>, <em>bad_uvrange='2~27m'</em>, <em>keepdelays=False</em>, <em>forsystemhealth=False</em>, <em>interp_thresh=1.5</em>, <em>interp_polyorder=7</em>, <em>blbased=False</em>, <em>manual_flags=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.routines.calibrate_measurement_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Calibrates the measurement set.</p>
<p>Calibration can be done with the aim of monitoring system health (set
<cite>forsystemhealth=True</cite>), obtaining beamformer weights (set
<cite>forsystemhealth=False</cite> and <cite>keepdelays=False</cite>), or obtaining delays (set
<cite>forsystemhealth=False</cite> and <cite>keepdelays=True</cite>, new beamformer weights will
be generated as well).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The name of the measurement set. Will open <cite>msname</cite>.ms</li>
<li><strong>cal</strong> (<em>dsacalib.utils.src instance</em>) &#8211; The calibration source. Calibration tables will begin with
<cite>msname</cite>_`cal.name`</li>
<li><strong>refant</strong> (<em>str or int</em>) &#8211; The reference antenna name (if str) or index (if int) for calibration.</li>
<li><strong>throw_exceptions</strong> (<em>bool</em>) &#8211; If set to False, exceptions will not be thrown, although they will be
logged to syslog. Defaults True.</li>
<li><strong>bad_antennas</strong> (<em>list(str)</em>) &#8211; Antennas (names) to be flagged before calibration.</li>
<li><strong>bad_uvrange</strong> (<em>str</em>) &#8211; Baselines with lengths within bad_uvrange will be flagged before
calibration. Must be a casa-understood string with units.</li>
<li><strong>keepdelays</strong> (<em>bool</em>) &#8211; Only used if <cite>forsystemhealth</cite> is False. If <cite>keepdelays</cite> is set to
False and <cite>forsystemhealth</cite> is set to False, then delays are integrated
into the bandpass solutions and the kcal table is set to all zeros. If
<cite>keepdelays</cite> is set to True and <cite>forsystemhealth</cite> is set to False, then
delays are kept at 2 nanosecond resolution.  If <cite>forsystemhealth</cite> is
set to True, delays are kept at full resolution regardless of the
keepdelays parameter. Defaults False.</li>
<li><strong>forsystemhealth</strong> (<em>bool</em>) &#8211; Set to True for full-resolution delay and bandpass solutions to use to
monitor system health, or to False to generate beamformer weights and
delays. Defaults False.</li>
<li><strong>interp_thresh</strong> (<em>float</em>) &#8211; Used if <cite>forsystemhealth</cite> is False, when smoothing bandpass gains.
The gain amplitudes and phases are fit using a polynomial after any
points more than interp_thresh*std away from the median-filtered trend
are flagged.</li>
<li><strong>interp_polyorder</strong> (<em>int</em>) &#8211; Used if <cite>forsystemhealth</cite> is False, when smoothing bandpass gains.
The gain amplitudes and phases are fit using a polynomial of order
interp_polyorder.</li>
<li><strong>blbased</strong> (<em>boolean</em>) &#8211; Set to True for baseline-based calibration, False for antenna-based
calibration.</li>
<li><strong>manual_flags</strong> (<em>list(str)</em>) &#8211; Include any additional flags to be done prior to calibration, as
CASA-understood strings.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A status code. Decode with dsautils.calstatus</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">int</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.routines.calibration_head">
<code class="descclassname">dsacalib.routines.</code><code class="descname">calibration_head</code><span class="sig-paren">(</span><em>obs_params</em>, <em>ant_params</em>, <em>write_to_etcd=False</em>, <em>throw_exceptions=None</em>, <em>sefd=False</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.routines.calibration_head" title="Permalink to this definition">¶</a></dt>
<dd><p>Controls calibrtion of a dsa10 or dsa110 dataset.</p>
<p>After calibration, results are writen to etcd.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>obs_params</strong> (<em>list</em>) &#8211; The observing parameters.</li>
<li><strong>ant_params</strong> (<em>list</em>) &#8211; The antenna configuration.</li>
<li><strong>write_to_etcd</strong> (<em>boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">True</span></code>, the results of the calibration are pushed to etcd.
Defaults <code class="docutils literal"><span class="pre">False</span></code>.</li>
<li><strong>throw_exceptions</strong> (<em>boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">False</span></code>, exceptions are not raised after being logged to
syslog. Instead, <cite>calibration_head</cite> and <cite>triple_antenna_cal</cite> return the
status value. If set to <code class="docutils literal"><span class="pre">None</span></code>, <cite>throw_exceptions</cite> will be set to
<code class="docutils literal"><span class="pre">not</span> <span class="pre">write_to_etcd</span></code>.</li>
<li><strong>sefd</strong> (<em>boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">True</span></code>, the solutions will be solved against a model of
ones in order to allow fitting of the source pass to the antenna gains
and 60 minutes will be saved to the measurement set.  If set to
<code class="docutils literal"><span class="pre">False</span></code>, a sky model will be used in calibration and only 10 minutes
of data is saved to the measurement set.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The status code. Decode with dsautils.calstatus.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">int</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.routines.dsa10_cal">
<code class="descclassname">dsacalib.routines.</code><code class="descname">dsa10_cal</code><span class="sig-paren">(</span><em>fname</em>, <em>msname</em>, <em>cal</em>, <em>pt_dec</em>, <em>antpos</em>, <em>refant</em>, <em>badants=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.routines.dsa10_cal" title="Permalink to this definition">¶</a></dt>
<dd><p>Calibrate dsa10 data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>fname</strong> (<em>str</em>) &#8211; The fits file containing the correlated dsa10 data.</li>
<li><strong>msname</strong> (<em>str</em>) &#8211; The measurement set containing the correlated dsa10 data.</li>
<li><strong>cal</strong> (<em>dsautils.src instance</em>) &#8211; The calibrator source.</li>
<li><strong>pt_dec</strong> (<em>float</em>) &#8211; The pointing declination of the array in radians.</li>
<li><strong>antpos</strong> (<em>str</em>) &#8211; The path to the ITRF file containing the antenna positions.</li>
<li><strong>refant</strong> (<em>str or int</em>) &#8211; The reference antenna name (if str) or index (if int).</li>
<li><strong>badants</strong> (<em>list(str)</em>) &#8211; The naems of antennas that should be flagged before calibration.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.routines.flag_antennas_using_delays">
<code class="descclassname">dsacalib.routines.</code><code class="descname">flag_antennas_using_delays</code><span class="sig-paren">(</span><em>antenna_delays</em>, <em>kcorr</em>, <em>msname</em>, <em>kcorr_thresh=0.3</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.routines.flag_antennas_using_delays" title="Permalink to this definition">¶</a></dt>
<dd><p>Flags antennas by comparing the delay on short times to the delay cal.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>antenna_delays</strong> (<em>ndarray</em>) &#8211; The antenna delays from the 2kcal calibration file, calculated on short
timescales.</li>
<li><strong>kcorr</strong> (<em>ndarray</em>) &#8211; The antenna delays from the kcal calibration file, calculated over the
entire calibration pass.</li>
<li><strong>msname</strong> (<em>str</em>) &#8211; The path to the measurement set. Will open <cite>msname</cite>.ms</li>
<li><strong>kcorr_thresh</strong> (<em>float</em>) &#8211; The tolerance for descrepancies between the antenna_delays and kcorr,
in nanoseconds.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.routines.flag_pixels">
<code class="descclassname">dsacalib.routines.</code><code class="descname">flag_pixels</code><span class="sig-paren">(</span><em>msname</em>, <em>thresh=6.0</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.routines.flag_pixels" title="Permalink to this definition">¶</a></dt>
<dd><p>Flags pixels using dsautils.mask_bad_pixels.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The path to the measurement set. Opens <cite>msname</cite>.ms</li>
<li><strong>thresh</strong> (<em>float</em>) &#8211; The RFI threshold in units of standard deviation. Anything above
thresh*stddev + mean will be flagged.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.routines.get_files_for_cal">
<code class="descclassname">dsacalib.routines.</code><code class="descname">get_files_for_cal</code><span class="sig-paren">(</span><em>caltable</em>, <em>refcorr='01'</em>, <em>duration=&lt;Quantity 5. min&gt;</em>, <em>filelength=&lt;Quantity 15. min&gt;</em>, <em>hdf5dir='/mnt/data/dsa110/correlator/'</em>, <em>date_specifier='*'</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.routines.get_files_for_cal" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a dictionary containing the filenames for each calibrator pass.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>caltable</strong> (<em>str</em>) &#8211; The path to the csv file containing calibrators of interest.</li>
<li><strong>refcorr</strong> (<em>str</em>) &#8211; The reference correlator to search for recent hdf5 files from. Searches
the directory <cite>hdf5dir</cite>/corr`refcorr`/</li>
<li><strong>duration</strong> (<em>astropy quantity</em>) &#8211; The duration around transit which you are interested in extracting, in
minutes or seconds.</li>
<li><strong>filelength</strong> (<em>astropy quantity</em>) &#8211; The length of the hdf5 files, in minutes or seconds.</li>
<li><strong>hdf5dir</strong> (<em>str</em>) &#8211; The path to the hdf5 files.</li>
<li><strong>date_specifier</strong> (<em>str</em>) &#8211; A specifier to include to limit the dates for which you are interested
in. Should be something interpretable by glob and should be to the
second precision. E.g. <cite>2020-10-06*</cite>, <cite>2020-10-0[678]*</cite> and
<cite>2020-10-06T01:03:??</cite> are all valid.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A dictionary specifying the hdf5 filenames that correspond to the
requested datesand calibrators.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dict</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.routines.plot_solutions">
<code class="descclassname">dsacalib.routines.</code><code class="descname">plot_solutions</code><span class="sig-paren">(</span><em>msname</em>, <em>calname</em>, <em>figure_path</em>, <em>show_plots=False</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.routines.plot_solutions" title="Permalink to this definition">¶</a></dt>
<dd><p>Plots the antenna delay, gain and bandpass calibration solutions.</p>
<p>Creates separate files for all solutions.  To create one plot with all
solutions, use plotting.summary_plot.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>msname</strong> (<em>str</em>) &#8211; The name of the measurement set. Used to identify the calibration
tables.</li>
<li><strong>calname</strong> (<em>str</em>) &#8211; The name of the calibrator. Used to identify the calibration tables.</li>
<li><strong>antenna_order</strong> (<em>list</em>) &#8211; The antenna names, in order.</li>
<li><strong>fobs</strong> (<em>array</em>) &#8211; The central frequency of each channel, in GHz.</li>
<li><strong>blbased</strong> (<em>boolean</em>) &#8211; True of the calibration was baseline-based.</li>
<li><strong>figure_dir</strong> (<em>str</em>) &#8211; The location to save the figures.  Defaults <code class="docutils literal"><span class="pre">./figures</span></code>.</li>
<li><strong>show_plots</strong> (<em>boolean</em>) &#8211; If False, plots are closed after being saved. Defaults False.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.routines.triple_antenna_cal">
<code class="descclassname">dsacalib.routines.</code><code class="descname">triple_antenna_cal</code><span class="sig-paren">(</span><em>obs_params</em>, <em>ant_params</em>, <em>throw_exceptions=True</em>, <em>sefd=False</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.routines.triple_antenna_cal" title="Permalink to this definition">¶</a></dt>
<dd><p>Calibrate visibilities from 3 antennas.</p>
<p>Assumes visbilities are stored using dsa-10 or dsa-110 fits format.
The caltable_to_etcd function should be able to handle this, but I haven&#8217;t
tested that yet.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>obs_params</strong> (<em>dict</em>) &#8211; Observing parameters</li>
<li><strong>ant_params</strong> (<em>dict</em>) &#8211; </li>
<li><strong>show_plots</strong> (<em>Boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">True</span></code>, plots of the delay and gain calibration solutions
will be shown. Defaults <code class="docutils literal"><span class="pre">False</span></code>.</li>
<li><strong>throw_exception</strong> (<em>Boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">True</span></code>, exceptions will be thrown after being logged in
syslog. If set to <code class="docutils literal"><span class="pre">False</span></code>, the exceptions will not be thrown, but
will still be logged in syslog. Defaults <code class="docutils literal"><span class="pre">True</span></code>.</li>
<li><strong>sefd</strong> (<em>Boolean</em>) &#8211; If set to <code class="docutils literal"><span class="pre">True</span></code>, enough data (60 minutes) will be included in the
measurement set to calculate the off-source power (60 minutes) and the
calibration solutions will be solved against a model of ones. If set to
<code class="docutils literal"><span class="pre">False</span></code>, only 10 minutes will be included in the measurement set and
the calibration solutison will be solved against a sky model.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>status</strong> (<em>int</em>) &#8211; The status code of the pipeline. Decode with dsautils.calstatus.</li>
<li><strong>caltime</strong> (<em>float</em>) &#8211; The meridian crossing time of the source in MJD. If the input file
could not be opened, <code class="docutils literal"><span class="pre">None</span></code> will be returned.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-dsacalib.utils">
<span id="dsacalib-utils-module"></span><h2>dsacalib.utils module<a class="headerlink" href="#module-dsacalib.utils" title="Permalink to this headline">¶</a></h2>
<p>DSACALIB/UTILS.PY</p>
<p>Dana Simard, <a class="reference external" href="mailto:dana&#46;simard&#37;&#52;&#48;astro&#46;caltech&#46;edu">dana<span>&#46;</span>simard<span>&#64;</span>astro<span>&#46;</span>caltech<span>&#46;</span>edu</a>, 10/2019</p>
<p>Modified for python3 from DSA-10 routines written by Vikram Ravi, Harish
Vendantham.</p>
<p>Routines to interact w/ fits visibilities recorded by DSA-10, hdf5 visibilities
recorded by DSA-110, and visibility in CASA measurement sets.</p>
<dl class="function">
<dt id="dsacalib.utils.daz_dha">
<code class="descclassname">dsacalib.utils.</code><code class="descname">daz_dha</code><span class="sig-paren">(</span><em>dec</em>, <em>daz=None</em>, <em>dha=None</em>, <em>lat=0.6498455107238486</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.utils.daz_dha" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts an offset between azimuth and hour angle.</p>
<p>Assumes that the offset in azimuth or hour angle from an azimuth of pi or
hour angle of 0 is small.  One of <cite>daz</cite> or <cite>dha</cite> must be provided, the
other is calculated.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>dec</strong> (<em>float</em>) &#8211; The pointing declination of the antenna in radians.</li>
<li><strong>daz</strong> (<em>float</em>) &#8211; The azimuth offset in radians. <code class="docutils literal"><span class="pre">None</span></code> may also be passed, in which
case the azimuth offset is calculated and returned. Defaults to
<code class="docutils literal"><span class="pre">None</span></code>.</li>
<li><strong>dha</strong> (<em>float</em>) &#8211; The hour angle offset in radians. <code class="docutils literal"><span class="pre">None</span></code> may also be passed, in which
case the hour angle offset is calculated and returned. Defaults to
<code class="docutils literal"><span class="pre">None</span></code>.</li>
<li><strong>lat</strong> (<em>float</em>) &#8211; The latitude of the antenna in radians.  Defaults to the value of
<code class="docutils literal"><span class="pre">ovro_lat</span></code> defined in <code class="docutils literal"><span class="pre">dsacalib.constants</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The converted offset. If the value of <cite>daz</cite> passed was not <code class="docutils literal"><span class="pre">None</span></code>,
this is the hour angle offset corresponding to the azimuth offset
<cite>daz</cite>. If the value of <cite>dha</cite> passed was not <code class="docutils literal"><span class="pre">None</span></code>, this is the
azimuth offset corresonding to the hour angle offset <cite>dha</cite>.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first">float</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><code class="xref py py-exc docutils literal"><span class="pre">RuntimeError</span></code> &#8211; If neither <cite>daz or `dha</cite> is defined.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.utils.exception_logger">
<code class="descclassname">dsacalib.utils.</code><code class="descname">exception_logger</code><span class="sig-paren">(</span><em>logger</em>, <em>task</em>, <em>exception</em>, <em>throw</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.utils.exception_logger" title="Permalink to this definition">¶</a></dt>
<dd><p>Logs exception traceback to syslog using the dsa_syslog module.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>logger</strong> (<em>dsa_syslog.DsaSyslogger() instance</em>) &#8211; The logger used for within the reduction pipeline.</li>
<li><strong>task</strong> (<em>str</em>) &#8211; A short description of where in the pipeline the error occured.</li>
<li><strong>exception</strong> (<em>Exception</em>) &#8211; The exception that occured.</li>
<li><strong>throw</strong> (<em>boolean</em>) &#8211; If set to True, the exception is raised after the traceback is written
to syslogs.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.utils.get_antpos_itrf">
<code class="descclassname">dsacalib.utils.</code><code class="descname">get_antpos_itrf</code><span class="sig-paren">(</span><em>antpos</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.utils.get_antpos_itrf" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads and orders antenna positions from a text or csv file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>antpos</strong> (<em>str</em>) &#8211; The path to the text or csv file containing the antenna positions.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="simple">
<li><strong>anum</strong> (<em>list(int)</em>) &#8211; The antenna numbers, in numerical order.</li>
<li><strong>xx, yy, zz</strong> (<em>list(float)</em>) &#8211; The ITRF coordinates of the antennas, in meters.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.utils.get_autobl_indices">
<code class="descclassname">dsacalib.utils.</code><code class="descname">get_autobl_indices</code><span class="sig-paren">(</span><em>nant</em>, <em>casa=False</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.utils.get_autobl_indices" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list of the indices containing the autocorrelations.</p>
<p>Can return the index for either correlator-ordered visibilities (<cite>casa</cite> set
to <code class="docutils literal"><span class="pre">False</span></code>) or CASA-ordered visibilities (<cite>casa</cite> set to <code class="docutils literal"><span class="pre">True</span></code>).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>nant</strong> (<em>int</em>) &#8211; The number of antennas in the visibility set.</li>
<li><strong>casa</strong> (<em>boolean</em>) &#8211; Whether the visibilities follow CASA ordering standards (<cite>casa</cite> set to
<code class="docutils literal"><span class="pre">True</span></code>) or DSA-10/DSA-110 correlator ordering standards (<cite>casa</cite> set
to <code class="docutils literal"><span class="pre">False</span></code>). Defaults to <code class="docutils literal"><span class="pre">False</span></code>, or correlator ordering standards.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>auto_bls</strong> &#8211; The list of indices in the visibilities corresponding to
autocorrelations.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.utils.mask_bad_bins">
<code class="descclassname">dsacalib.utils.</code><code class="descname">mask_bad_bins</code><span class="sig-paren">(</span><em>vis</em>, <em>axis</em>, <em>thresh=6.0</em>, <em>medfilt=False</em>, <em>nmed=129</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.utils.mask_bad_bins" title="Permalink to this definition">¶</a></dt>
<dd><p>Masks bad channels or time bins in visibility data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>vis</strong> (<em>ndarray</em>) &#8211; The visibility array, with dimensions (baselines, time, frequency,
polarization)</li>
<li><strong>axis</strong> (<em>int</em>) &#8211; The axis to flag along. <cite>axis</cite> set to 1 will flag bad time bins. <cite>axis</cite>
set to 2 will flag bad frequency bins.</li>
<li><strong>thresh</strong> (<em>float</em>) &#8211; The threshold above which to flag data. Anything that deviates from the
median by more than <cite>thresh</cite> multiplied by the standard deviation is
flagged.</li>
<li><strong>medfilt</strong> (<em>Boolean</em>) &#8211; Whether to median filter to remove an average trend. If <code class="docutils literal"><span class="pre">True</span></code>, will
median filter. If <code class="docutils literal"><span class="pre">False</span></code>, will subtract the median for the
baseline/pol pair.</li>
<li><strong>nmed</strong> (<em>int</em>) &#8211; The size of the median filter to use. Only used in medfilt is <code class="docutils literal"><span class="pre">True</span></code>.
Must be an odd integer.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>good_bins</strong> (<em>ndarray</em>) &#8211; Has a value of 1 where the bin is good, and 0 where the bin should be
flagged. If <cite>axis</cite> is 2, the dimensions are (baselines, 1, frequency,
polarization). If <cite>axis</cite> is 1, the dimensions are (baselines, time, 1,
polarization).</li>
<li><strong>fraction_flagged</strong> (<em>ndarray</em>) &#8211; The fraction of data flagged for each baseline/polarization pair.
Dimensions (baselines, polarization).</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dsacalib.utils.mask_bad_pixels">
<code class="descclassname">dsacalib.utils.</code><code class="descname">mask_bad_pixels</code><span class="sig-paren">(</span><em>vis</em>, <em>thresh=6.0</em>, <em>mask=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.utils.mask_bad_pixels" title="Permalink to this definition">¶</a></dt>
<dd><p>Masks pixels with values above a SNR threshold within each visibility.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>vis</strong> (<em>ndarray</em>) &#8211; The complex visibilities. Dimensions (baseline, time, frequency,
polarization).</li>
<li><strong>thresh</strong> (<em>float</em>) &#8211; The threshold above which to flag data. Data above <cite>thresh</cite>*the
standard deviation in each channel of each visiblity is flagged.
Defaults 6.</li>
<li><strong>mask</strong> (<em>ndarray</em>) &#8211; A mask for data that is already flagged. Should be 0 where data has
been flagged, 1 otherwise. Same dimensions as <cite>vis</cite>.  Data previously
flagged is not used in the calculation of the channel standard
deviations.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>good_pixels</strong> (<em>ndarray</em>) &#8211; Whether a given pixel in <cite>vis</cite> is good (1 or <code class="docutils literal"><span class="pre">True</span></code>) or bad (i.e.
above the threshold: 0 or <code class="docutils literal"><span class="pre">False</span></code>). Same dimensions as <code class="docutils literal"><span class="pre">vis</span></code>.</li>
<li><strong>fraction_flagged</strong> (<em>array</em>) &#8211; The ratio of the flagged data to the total number of pixels for each
baseline/polarization.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="dsacalib.utils.src">
<em class="property">class </em><code class="descclassname">dsacalib.utils.</code><code class="descname">src</code><span class="sig-paren">(</span><em>name</em>, <em>ra</em>, <em>dec</em>, <em>I=1.0</em>, <em>epoch='J2000'</em>, <em>pa=None</em>, <em>maj_axis=None</em>, <em>min_axis=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.utils.src" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>Simple class for holding source parameters.</p>
</dd></dl>

<dl class="function">
<dt id="dsacalib.utils.to_deg">
<code class="descclassname">dsacalib.utils.</code><code class="descname">to_deg</code><span class="sig-paren">(</span><em>string</em><span class="sig-paren">)</span><a class="headerlink" href="#dsacalib.utils.to_deg" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a string representation of RA or DEC to degrees.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>string</strong> (<em>str</em>) &#8211; RA or DEC in string format e.g. &#8220;12h00m19.21s&#8221; or &#8220;+73d00m45.7s&#8221;.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><strong>deg</strong> &#8211; The angle in degrees.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">astropy quantity</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-dsacalib">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-dsacalib" title="Permalink to this headline">¶</a></h2>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">dsacalib package</a><ul>
<li><a class="reference internal" href="#submodules">Submodules</a></li>
<li><a class="reference internal" href="#module-dsacalib.calib">dsacalib.calib module</a></li>
<li><a class="reference internal" href="#module-dsacalib.constants">dsacalib.constants module</a></li>
<li><a class="reference internal" href="#module-dsacalib.fits_io">dsacalib.fits_io module</a></li>
<li><a class="reference internal" href="#module-dsacalib.fringestopping">dsacalib.fringestopping module</a></li>
<li><a class="reference internal" href="#module-dsacalib.hdf5_io">dsacalib.hdf5_io module</a></li>
<li><a class="reference internal" href="#module-dsacalib.ms_io">dsacalib.ms_io module</a></li>
<li><a class="reference internal" href="#module-dsacalib.plotting">dsacalib.plotting module</a></li>
<li><a class="reference internal" href="#module-dsacalib.preprocess">dsacalib.preprocess module</a></li>
<li><a class="reference internal" href="#module-dsacalib.routines">dsacalib.routines module</a></li>
<li><a class="reference internal" href="#module-dsacalib.utils">dsacalib.utils module</a></li>
<li><a class="reference internal" href="#module-dsacalib">Module contents</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="modules.html">dsacalib</a><ul>
      <li>Previous: <a href="modules.html" title="previous chapter">dsacalib</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/dsacalib.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Dana Simard.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.8</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/dsacalib.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>